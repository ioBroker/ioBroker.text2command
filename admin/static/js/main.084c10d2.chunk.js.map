{"version":3,"sources":["serviceWorker.js","components/Rule.js","components/Drawer.js","components/RuleEditor.js","components/CreateRuleDialog.js","components/Layout.js","App.js","index.js"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","Rule","React","forwardRef","props","ref","name","handleEdit","handleCopy","rule","isDragging","connectDragSource","connectDropTarget","id","selectRule","selectedRule","_break","matchingRules","unsavedRules","index","theme","removeMatched","words","unique","classes","makeStyles","listItem","cursor","transition","position","paddingTop","paddingBottom","borderBottom","palette","text","primary","startsWith","listItemText","listItemTextPrimary","color","textOverflow","overflow","whiteSpace","listItemTextSecondary","opacity","type","fontStyle","dot","backgroundColor","top","right","height","fontSize","borderRadius","padding","textAlign","maximize","dark","marginTop","spacing","ruleButton","editButton","width","bottom","left","paddingLeft","emptyButton","multiline","marginBottom","elementRef","useRef","useImperativeHandle","getNode","current","selectRuleMemo","useCallback","handleEditMemo","handleCopyMemo","useState","ruleStyle","setRuleStyle","useEffect","length","matchingRule","find","item","indexOf","setTimeout","secondary","light","timer","background","default","style","Object","assign","ListItem","onClick","selected","className","clsx","root","ListItemText","ListItemIcon","Tooltip","title","I18n","t","IconButton","size","FileCopy","ItemTypes","DropTarget","hover","monitor","component","node","dragIndex","getItem","hoverIndex","hoverBoundingRect","getBoundingClientRect","hoverMiddleY","hoverClientY","getClientOffset","y","moveRule","connect","dropTarget","DragSource","beginDrag","dragSource","CustomTooltip","withStyles","tooltip","Drawer","getDefaultSettings","setState","localSettings","settings","onAlive","val","alive","onResponse","toast","toastError","socket","getState","instance","handleTextCommand","event","textCommand","target","value","testTimer","clearTimeout","matched","findMatchingRules","map","number","handleSubmit","iconPlay","key","err","handleOpenSettingsModal","isSettingsDialogOpen","handleDialogSelectIdSubmit","selectedSettingsName","handleDelete","removeRule","handleCloseConfirmRemoveDialog","isConfirmRemoveDialogOpen","handleSearch","matchedRules","rules","filter","toLowerCase","includes","filteredRules","searchedValue","toggleSearch","a","isSearchActive","createSettingsModal","handleClose","isSettingsWasNotSaved","handleChange","undefined","checked","Dialog","open","onClose","fullWidth","onExited","DialogTitle","Typography","variant","align","DialogContent","noValidate","autoComplete","Grid","container","direction","FormControl","settingsItem","InputLabel","Select","width100","onChange","language","MenuItem","Children","toArray","option","selectIdText","TextField","label","sayitInstance","Button","selectIdButton","showDialogSelectId","selectedId","processorId","helperText","processorTimeout","e","FormControlLabel","control","Checkbox","writeEveryAnswer","DialogActions","saveSettings","startIcon","mainIcons","icon","handler","handleOpen","createIcons","iconsData","this","subscribeState","document","getElementsByClassName","scrollIntoView","unsubscribeState","prevProps","prevState","findMatched","JSON","parse","stringify","imagePrefix","onOk","autoFocus","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","Alert","elevation","severity","isMobile","closeDrawer","settingsDialog","renderedRules","additionalIcons","push","Box","main","Toolbar","toolbar","disableGutters","search","InputProps","endAdornment","closeBtn","flexGrow","iconNotAlive","DndProvider","backend","HTML5Backend","List","list","test","onKeyDown","inputProps","play","renderConfirmDialog","renderSelectIdDialog","renderToast","Component","boxSizing","minWidth","overflowX","overflowY","header","minHeight","border","divider","textInput","breakpoints","down","settingsTitle","maxWidth","settingsContent","flexDirection","display","common","white","float","marginRight","flexBasis","RuleEditor","defaultState","editable","args","ack","localRule","showDialog","createConfirmModalActions","updateConfig","pendingSelectedRuleId","clearStateOnConfirmModalUnmount","revertChangesFromConfig","cancelSavingChanges","closeConfirmDialog","dontSaveAndGo","handleSaveAndGo","submitForm","saveAndGoBtn","btnDanger","createSaveSettingsForm","handleSave","isLocalStateWasUpdated","revertChanges","emptyButtons","confirmChanges","createInput","onOpenSelectDialog","note","disabled","keywords","onSwitchChange","inputOid","inputOidButton","textField","rowPadding","switchControl","Switch","FormLabel","createOptionsData","handlers","isKeyWordsDisabled","keywordsText","breakOnSwitch","openSelectIdDialog","param1OnSwitch","param2Text","param2OnSwitch","confirmText","confirmOnSwitch","createInputHandlers","_this","arg","showDialogId","onIDSelected","unsavedRule","isEqual","wasChangedGlobally","removeUnsavedRule","setUnsavedRule","lang","forceUpdate","isLeftBarOpen","toggleLeftBar","toggleIcon","box","boxMobile","boxDesktop","Paper","gridTemplateColumns","rowSpace","PureComponent","margin","justifyContent","mainTitle","row","alignItems","marginLeft","zIndex","noRulesText","fontWeight","CreateRuleDialog","defaultRule","isDisabled","setRuleOnMount","isEdit","cleanState","isCopy","finishEdit","getAvailableOptions","commands","uniqueOptions","concat","getUniqueName","ruleName","matchingNames","slice","isUnique","lastChar","createForm","onSubmitHandler","handleSubmitOnCopy","handleSubmitOnEdit","handleSubmitOnCreate","FormGroup","shrink","isError","labelId","select","keyCode","preventDefault","stopPropagation","existingNames","setDialogContent","isOpen","onEnter","Layout","getSelectedLanguageCommands","getLanguage","entries","command","rest","template","sourceRule","_","sortRules","splice","uuid","shortDataRule","isUnsavedChanges","values","updateRule","newRule","editableRule","updatedRuleOptions","_rule","it","readConfig","newConfig","saveConfig","currentSelectedRule","ids","updatedCurrentRules","updatedRules","getRuleShortData","getDataFromConfig","currentRules","obj","ready","localStorage","actualRules","isRuleWasUpdatedGlobally","newState","localeSettings","closeModal","setItem","menuSize","parseFloat","rulesWithId","en","setLanguage","Fragment","anchor","themeType","renderModalDialog","customClassName","hidden","opened","layout","primaryMinSize","primaryIndex","secondaryMinSize","onSecondaryPaneSizeChange","onDragEnd","toString","secondaryInitialSize","withWidth","App","extendedProps","translations","require","getSystemConfig","systemConfig","showError","getObject","adapterName","native","setObject","bind","renderError","GenericApp","logo","themeName","Utils","getThemeName","version","host","Sentry","dsn","release","integrations","SentryIntegrations","build","ReactDOM","render","onThemeChange","_theme","getElementById","URL","process","href","origin","addEventListener","fetch","response","contentType","headers","get","status","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.084c10d2.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read http://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n\twindow.location.hostname === \"localhost\" ||\r\n\t\t// [::1] is the IPv6 localhost address.\r\n\t\twindow.location.hostname === \"[::1]\" ||\r\n\t\t// 127.0.0.1/8 is considered localhost for IPv4.\r\n\t\twindow.location.hostname.match(\r\n\t\t\t/^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n\t\t)\r\n);\r\n\r\nexport function register(config) {\r\n\tif (process.env.NODE_ENV === \"production\" && \"serviceWorker\" in navigator) {\r\n\t\t// The URL constructor is available in all browsers that support SW.\r\n\t\tconst publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n\t\tif (publicUrl.origin !== window.location.origin) {\r\n\t\t\t// Our service worker won't work if PUBLIC_URL is on a different origin\r\n\t\t\t// from what our page is served on. This might happen if a CDN is used to\r\n\t\t\t// serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\twindow.addEventListener(\"load\", () => {\r\n\t\t\tconst swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n\t\t\tif (isLocalhost) {\r\n\t\t\t\t// This is running on localhost. Let's check if a service worker still exists or not.\r\n\t\t\t\tcheckValidServiceWorker(swUrl, config);\r\n\r\n\t\t\t\t// Add some additional logging to localhost, pointing developers to the\r\n\t\t\t\t// service worker/PWA documentation.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(() => {\r\n\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t\"This web app is being served cache-first by a service \" +\r\n\t\t\t\t\t\t\t\"worker. To learn more, visit http://bit.ly/CRA-PWA\"\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Is not localhost. Just register service worker\r\n\t\t\t\tregisterValidSW(swUrl, config);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n\tnavigator.serviceWorker\r\n\t\t.register(swUrl)\r\n\t\t.then(registration => {\r\n\t\t\tregistration.onupdatefound = () => {\r\n\t\t\t\tconst installingWorker = registration.installing;\r\n\t\t\t\tif (installingWorker == null) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tinstallingWorker.onstatechange = () => {\r\n\t\t\t\t\tif (installingWorker.state === \"installed\") {\r\n\t\t\t\t\t\tif (navigator.serviceWorker.controller) {\r\n\t\t\t\t\t\t\t// At this point, the updated precached content has been fetched,\r\n\t\t\t\t\t\t\t// but the previous service worker will still serve the older\r\n\t\t\t\t\t\t\t// content until all client tabs are closed.\r\n\t\t\t\t\t\t\tconsole.log(\r\n\t\t\t\t\t\t\t\t\"New content is available and will be used when all \" +\r\n\t\t\t\t\t\t\t\t\t\"tabs for this page are closed. See http://bit.ly/CRA-PWA.\"\r\n\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t// Execute callback\r\n\t\t\t\t\t\t\tif (config && config.onUpdate) {\r\n\t\t\t\t\t\t\t\tconfig.onUpdate(registration);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// At this point, everything has been precached.\r\n\t\t\t\t\t\t\t// It's the perfect time to display a\r\n\t\t\t\t\t\t\t// \"Content is cached for offline use.\" message.\r\n\t\t\t\t\t\t\tconsole.log(\"Content is cached for offline use.\");\r\n\r\n\t\t\t\t\t\t\t// Execute callback\r\n\t\t\t\t\t\t\tif (config && config.onSuccess) {\r\n\t\t\t\t\t\t\t\tconfig.onSuccess(registration);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t})\r\n\t\t.catch(error => {\r\n\t\t\tconsole.error(\"Error during service worker registration:\", error);\r\n\t\t});\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n\t// Check if the service worker can be found. If it can't reload the page.\r\n\tfetch(swUrl)\r\n\t\t.then(response => {\r\n\t\t\t// Ensure service worker exists, and that we really are getting a JS file.\r\n\t\t\tconst contentType = response.headers.get(\"content-type\");\r\n\t\t\tif (\r\n\t\t\t\tresponse.status === 404 ||\r\n\t\t\t\t(contentType != null && contentType.indexOf(\"javascript\") === -1)\r\n\t\t\t) {\r\n\t\t\t\t// No service worker found. Probably a different app. Reload the page.\r\n\t\t\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\t\t\tregistration.unregister().then(() => {\r\n\t\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t// Service worker found. Proceed as normal.\r\n\t\t\t\tregisterValidSW(swUrl, config);\r\n\t\t\t}\r\n\t\t})\r\n\t\t.catch(() => {\r\n\t\t\tconsole.log(\r\n\t\t\t\t\"No internet connection found. App is running in offline mode.\"\r\n\t\t\t);\r\n\t\t});\r\n}\r\n\r\nexport function unregister() {\r\n\tif (\"serviceWorker\" in navigator) {\r\n\t\tnavigator.serviceWorker.ready.then(registration => {\r\n\t\t\tregistration.unregister();\r\n\t\t});\r\n\t}\r\n}\r\n","import React, {\r\n    useRef,\r\n    useImperativeHandle,\r\n    useCallback,\r\n    useState,\r\n    useEffect,\r\n} from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport PropTypes from 'prop-types';\r\nimport clsx from 'clsx';\r\nimport { DropTarget, DragSource } from 'react-dnd';\r\n\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\r\n\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\n\r\nimport EditIcon from '@material-ui/icons/Edit';\r\nimport ArrowDownwardIcon from '@material-ui/icons/ArrowDownward';\r\nimport MaximizeIcon from '@material-ui/icons/Maximize';\r\nimport {FileCopy} from \"@material-ui/icons\";\r\n\r\nconst Rule = React.forwardRef((props, ref) => {\r\n    const {\r\n        name,\r\n        handleEdit,\r\n        handleCopy,\r\n        rule,\r\n        isDragging,\r\n        connectDragSource,\r\n        connectDropTarget,\r\n        id,\r\n        selectRule,\r\n        selectedRule,\r\n        _break,\r\n        matchingRules,\r\n        unsavedRules,\r\n        index,\r\n        theme,\r\n        removeMatched,\r\n        words,\r\n        unique,\r\n    } = props;\r\n\r\n    const classes = makeStyles({\r\n        listItem: {\r\n            cursor: 'pointer',\r\n            transition: 'background-color 0.3s linear',\r\n            position: 'relative',\r\n            paddingTop: 4,\r\n            paddingBottom: 12,\r\n            borderBottom: '1px dashed ' + theme.palette.text.primary + (theme.palette.text.primary.startsWith('rgb') ? '' : '30'),\r\n        },\r\n        listItemText: {\r\n        },\r\n        listItemTextPrimary: {\r\n            color: theme.palette.text.primary,\r\n            textOverflow: 'ellipsis',\r\n            overflow: 'hidden',\r\n            whiteSpace: 'nowrap',\r\n        },\r\n        listItemTextSecondary: {\r\n            textOverflow: 'ellipsis',\r\n            overflow: 'hidden',\r\n            opacity: theme.palette.type === 'dark' ? 0.2 : 0.7,\r\n            fontStyle: 'italic',\r\n        },\r\n        dot: {\r\n            position: 'absolute',\r\n            backgroundColor: 'red',\r\n            top: 3,\r\n            right: 15,\r\n            height: 10,\r\n            fontSize: 10,\r\n            borderRadius: 10,\r\n            padding: '0 5px 5px 5px',\r\n            textAlign: 'center',\r\n            color: '#FFF',\r\n        },\r\n        maximize: {\r\n            color: theme.palette.error?.dark,\r\n            marginTop: theme.spacing(1),\r\n        },\r\n        ruleButton: {\r\n            paddingTop: theme.spacing(1.5),\r\n        },\r\n        editButton: {\r\n            height: 32,\r\n        },\r\n        words: {\r\n            fontSize: 12,\r\n            opacity: 0.5,\r\n            width: 'calc(100% - 40px)',\r\n            position: 'absolute',\r\n            bottom: 4,\r\n            left: 0,\r\n            paddingLeft: 17,\r\n            color: theme.palette.text.primary,\r\n            whiteSpace: 'nowrap',\r\n            overflow: 'hidden',\r\n            textOverflow: 'ellipsis'\r\n        },\r\n        emptyButton: {\r\n            width: 30,\r\n        },\r\n        multiline: {\r\n            marginTop: 0,\r\n            marginBottom: 12,\r\n        }\r\n    })();\r\n\r\n    const elementRef = useRef(null);\r\n    connectDragSource(elementRef);\r\n    connectDropTarget(elementRef);\r\n    const opacity = isDragging ? 0 : 1;\r\n    useImperativeHandle(ref, () => ({\r\n        getNode: () => elementRef.current,\r\n    }));\r\n\r\n    const selectRuleMemo = useCallback(() => selectRule(id), [id, selectRule]);\r\n    const handleEditMemo = useCallback(() => handleEdit(id), [id, handleEdit]);\r\n    const handleCopyMemo = useCallback(() => handleCopy(id), [id, handleCopy]);\r\n\r\n    const [ruleStyle, setRuleStyle] = useState({});\r\n\r\n    useEffect(() => {\r\n        if (matchingRules.length) {\r\n            const matchingRule = matchingRules.find(item => item.indexOf === index);\r\n            if (matchingRule) {\r\n                setTimeout(() => setRuleStyle({backgroundColor: theme.palette.type === 'dark' ? theme?.palette?.secondary.dark : theme?.palette?.secondary.light}), matchingRule.timer);\r\n\r\n                setTimeout(() => {\r\n                    setRuleStyle(selectedRule.id === id ? {backgroundColor: theme?.palette?.background?.default} : {});\r\n                    if (_break || index === matchingRules[matchingRules.length - 1].indexOf) {\r\n                        removeMatched();\r\n                    }\r\n                }, 1500 * (matchingRule.index + 1));\r\n            } // only when matching rules have been changed\r\n        } // eslint-disable-next-line\r\n    }, [matchingRules]);\r\n\r\n    let secondary = rule !== name ? rule || '' : '';\r\n\r\n    return <div\r\n        ref={elementRef}\r\n        style={Object.assign({}, {opacity}, ruleStyle)}>\r\n        <ListItem\r\n            onClick={selectRuleMemo}\r\n            selected={selectedRule?.id === id}\r\n            className={clsx(selectedRule?.id === id && 'rule-selected')}\r\n            classes={{root: classes.listItem}}\r\n        >\r\n            <ListItemText\r\n                primary={name}\r\n                secondary={secondary}\r\n                classes={{\r\n                    primary: classes.listItemTextPrimary,\r\n                    secondary: classes.listItemTextSecondary,\r\n                    multiline: classes.multiline}}\r\n                className={classes.listItemText}\r\n            />\r\n            <ListItemIcon>\r\n                {\r\n                    _break ?\r\n                        <Tooltip title={I18n.t('Interrupt processing')}>\r\n                            <MaximizeIcon className={clsx(classes.ruleButton, classes.maximize)} />\r\n                        </Tooltip>\r\n                    :\r\n                        <Tooltip title={I18n.t('Do not interrupt processing')}><ArrowDownwardIcon className={classes.ruleButton} color=\"primary\"/></Tooltip>\r\n                }\r\n                {!unique ? <Tooltip title={I18n.t('Copy rule')}>\r\n                    <IconButton onClick={handleCopyMemo}  size=\"small\" className={classes.editButton}>\r\n                        <FileCopy />\r\n                    </IconButton>\r\n                </Tooltip> : <div className={classes.emptyButton} />}\r\n                <Tooltip title={I18n.t('Edit name or type of rule')}>\r\n                    <IconButton onClick={handleEditMemo} size=\"small\" className={classes.editButton}>\r\n                        <EditIcon />\r\n                    </IconButton>\r\n                </Tooltip>\r\n            </ListItemIcon>\r\n            {unsavedRules[id] && <div className={classes.dot}>{I18n.t('unsaved')}</div>}\r\n            <div className={classes.words}>[{words}]</div>\r\n        </ListItem>\r\n    </div>;\r\n});\r\n\r\nconst ItemTypes = {\r\n    RULE: 'rule',\r\n};\r\n\r\nexport default DropTarget(\r\n    ItemTypes.RULE,\r\n    {\r\n        hover(props, monitor, component) {\r\n            if (!component) {\r\n                return null;\r\n            }\r\n\r\n            const node = component.getNode();\r\n            if (!node) {\r\n                return null;\r\n            }\r\n            const dragIndex = monitor.getItem().index;\r\n            const hoverIndex = props.index;\r\n            if (dragIndex === hoverIndex) {\r\n                return;\r\n            }\r\n\r\n            const hoverBoundingRect = node.getBoundingClientRect();\r\n            const hoverMiddleY = (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\r\n            const clientOffset = monitor.getClientOffset();\r\n            const hoverClientY = clientOffset.y - hoverBoundingRect.top;\r\n            if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\r\n                return;\r\n            }\r\n            if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\r\n                return;\r\n            }\r\n            props.moveRule(dragIndex, hoverIndex);\r\n\r\n            monitor.getItem().index = hoverIndex;\r\n        },\r\n    },\r\n    connect => ({ connectDropTarget: connect.dropTarget() })\r\n)(\r\n    DragSource(\r\n        ItemTypes.RULE,\r\n        {\r\n            beginDrag: props => ({\r\n                id: props.id,\r\n                index: props.index,\r\n            }),\r\n        },\r\n        (connect, monitor) => ({\r\n            connectDragSource: connect.dragSource(),\r\n            isDragging: monitor.isDragging(),\r\n        })\r\n    )(Rule)\r\n);\r\n\r\nRule.propTypes = {\r\n    removeRule: PropTypes.func,\r\n    name: PropTypes.string.isRequired,\r\n    theme: PropTypes.object.isRequired,\r\n    isDragging: PropTypes.bool,\r\n    connectDropTarget: PropTypes.func,\r\n    connectDragTarget: PropTypes.func,\r\n    _break: PropTypes.bool.isRequired,\r\n    selectRule: PropTypes.func.isRequired,\r\n    id: PropTypes.string.isRequired,\r\n    matchingRules: PropTypes.array,\r\n    unique: PropTypes.bool,\r\n    selectedRule: PropTypes.shape({id: PropTypes.string}),\r\n    unsavedRules: PropTypes.object,\r\n};\r\n","import React, { Component, Children } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport clsx from 'clsx';\r\nimport { DndProvider } from 'react-dnd';\r\nimport { HTML5Backend } from 'react-dnd-html5-backend';\r\nimport withStyles from '@material-ui/core/styles/withStyles';\r\n\r\n// Material UI Components\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport PlayArrowIcon from '@material-ui/icons/PlayArrow';\r\nimport Tooltip from '@material-ui/core/Tooltip';\r\nimport List from '@material-ui/core/List';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Box from '@material-ui/core/Box';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport Button from '@material-ui/core/Button';\r\nimport Select from '@material-ui/core/Select';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\n\r\n// icons\r\nimport AddIcon from '@material-ui/icons/Add';\r\nimport SettingsIcon from '@material-ui/icons/Settings';\r\nimport CachedIcon from '@material-ui/icons/Cached';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport SearchIcon from '@material-ui/icons/Search';\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport FormatClearIcon from '@material-ui/icons/FormatClear';\r\nimport ClearIcon from '@material-ui/icons/Close';\r\nimport WarningIcon from '@material-ui/icons/Warning';\r\n\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\nimport DialogSelectID from '@iobroker/adapter-react/Dialogs/SelectID';\r\n\r\nimport Rule from './Rule';\r\nimport CheckIcon from \"@material-ui/icons/Check\";\r\nimport {Grid} from \"@material-ui/core\";\r\n\r\n\r\nconst styles = theme => ({\r\n    test: {\r\n        width: '100%',\r\n        boxSizing: 'border-box',\r\n        paddingLeft: theme.spacing(1)\r\n    },\r\n    main: {\r\n        minWidth: 300,\r\n        overflow: 'hidden',\r\n        height: '100%',\r\n    },\r\n    toolbar: {\r\n        background: theme.palette.primary.main,\r\n        position: 'relative',\r\n    },\r\n    list: {\r\n        height: 'calc(100% - 48px - 48px - 8px)',\r\n        overflowX: 'hidden',\r\n        overflowY: 'auto',\r\n        paddingTop: 0.,\r\n    },\r\n    root: {\r\n        width: 'calc(100% - 48px)',\r\n        // '& .MuiInputLabel-outlined-70.MuiInputLabel-marginDense-66': {\r\n        //     transform: '',\r\n        // },\r\n    },\r\n    header: {\r\n        minHeight: 44,\r\n        height: 'auto',\r\n        padding: theme.spacing(1.3),\r\n        border: `1px solid ${theme.palette.divider}`,\r\n    },\r\n    textInput: {\r\n        width: '60%',\r\n        [theme.breakpoints.down('sm')]: {\r\n            width: '100%',\r\n        },\r\n    },\r\n    settingsTitle: {\r\n        fontSize: '20px',\r\n        maxWidth: 145,\r\n        [theme.breakpoints.down('sm')]: {\r\n            marginBottom: theme.spacing(1),\r\n        },\r\n    },\r\n    settingsContent: {\r\n        [theme.breakpoints.down('sm')]: {\r\n            flexDirection: 'column',\r\n            display: 'flex',\r\n        },\r\n    },\r\n    closeBtn: {\r\n        position: 'absolute',\r\n        top: 0,\r\n        right: 0,\r\n        color: theme.palette.common.white,\r\n    },\r\n    iconNotAlive: {\r\n        color: '#ffc10a',\r\n        float: 'right',\r\n        marginRight: theme.spacing(1)\r\n    },\r\n    search: {\r\n        flexBasis: '80%',\r\n        [theme.breakpoints.down('sm')]: {\r\n            flexBasis: '70%',\r\n        },\r\n    },\r\n    settingsItem: {\r\n        marginBottom: theme.spacing(3),\r\n    },\r\n    width100: {\r\n        width: '100%',\r\n    },\r\n    selectIdText: {\r\n        width: 'calc(100% - 50px)'\r\n    },\r\n    selectIdButton: {\r\n        minWidth: 40,\r\n    }\r\n});\r\n\r\nconst tooltipStyles = theme => ({\r\n    tooltip: {\r\n        fontSize: 14,\r\n    },\r\n});\r\n\r\nconst CustomTooltip = withStyles(tooltipStyles)(Tooltip);\r\n\r\nclass Drawer extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            textCommand: '',\r\n            matchingRules: [],\r\n            isSettingsDialogOpen: false,\r\n            isConfirmRemoveDialogOpen: false,\r\n            isSearchActive: false,\r\n            filteredRules: [],\r\n            searchedValue: '',\r\n            localSettings: {\r\n                language: this.props.settings.language || '',\r\n                processorId:  this.props.settings.processorId || '',\r\n                processorTimeout:  this.props.settings.processorTimeout || 1000,\r\n                sayitInstance:  this.props.settings.sayitInstance || '',\r\n            },\r\n            toast: null,\r\n            alive: false,\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.props.socket.subscribeState(`text2command.${this.props.instance}.response`, this.onResponse);\r\n        this.props.socket.subscribeState(`system.adapter.text2command.${this.props.instance}.alive`, this.onAlive);\r\n\r\n        if (this.props.selectedRule && this.props.selectedRule.id) {\r\n            //scroll to\r\n            setTimeout(() => {\r\n                const rules = window.document.getElementsByClassName('rule-selected');\r\n                if (rules.length) {\r\n                    rules[0].scrollIntoView()\r\n                }\r\n            }, 50);\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.props.socket.unsubscribeState(`text2command.${this.props.instance}.response`, this.onResponse);\r\n        this.props.socket.unsubscribeState(`system.adapter.text2command.${this.props.instance}.alive`, this.onAlive);\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState) {\r\n        if (this.props.settings !== prevProps.settings && this.props.settings) {\r\n            this.getDefaultSettings();\r\n        }\r\n    }\r\n\r\n    getDefaultSettings = () => {\r\n        this.setState({\r\n            localSettings: {\r\n                ...this.props.settings,\r\n            },\r\n        });\r\n    };\r\n\r\n    onAlive = (id, state) => {\r\n        if (state && state.val) {\r\n            !this.state.alive && this.setState({alive: true});\r\n        } else {\r\n            this.state.alive && this.setState({alive: false});\r\n        }\r\n    };\r\n\r\n    onResponse = (id, state) => {\r\n        if (this.state.toast === null) {\r\n            this.setState({toast: '', toastError: false});\r\n        } else\r\n        if (state) {\r\n            if (state.val && state.val.match(/^Error\\.|^Fehler\\.|^\\./)) {\r\n                this.props.socket.getState('text2command.' + this.props.instance + '.error')\r\n                    .then(state =>\r\n                        this.setState({toast: state && state.val ? state.val : (state.val || ''), toastError: true}));\r\n            } else {\r\n                this.setState({toast: state.val || '', toastError: false});\r\n            }\r\n        }\r\n    };\r\n\r\n    handleTextCommand = event => {\r\n        this.setState({textCommand: event.target.value}, () => {\r\n            this.testTimer && clearTimeout(this.testTimer);\r\n            this.testTimer = setTimeout(() => {\r\n                const matched = this.findMatchingRules();\r\n                this.setState({\r\n                    matchingRules: matched.map((number, index) => ({\r\n                        indexOf: number,\r\n                        timer: index * 1500,\r\n                        index,\r\n                    })),\r\n                });\r\n            }, 500);\r\n        });\r\n    };\r\n\r\n    handleSubmit = (event, iconPlay) => {\r\n        if ((event && event.key === 'Enter') || iconPlay) {\r\n            this.props.socket.setState(`text2command.${this.props.instance}.text`, this.state.textCommand)\r\n                .catch(err => console.error(err));\r\n\r\n            if (!this.state.alive) {\r\n                this.setState({toast: I18n.t('Instance is not running'), toastError: true});\r\n            }\r\n        }\r\n    };\r\n\r\n    removeMatched = () => {\r\n        this.setState({matchingRules: []});\r\n    };\r\n\r\n    findMatchingRules() {\r\n        const text = this.state.textCommand;\r\n        return text ? window.findMatched(text, JSON.parse(JSON.stringify(this.props.rules))) : [];\r\n    }\r\n\r\n    handleOpenSettingsModal = () => {\r\n        this.setState({isSettingsDialogOpen: true});\r\n    };\r\n\r\n    handleDialogSelectIdSubmit = (selected, selectedSettingsName) => {\r\n        this.setState({\r\n            localSettings: {\r\n                ...this.state.localSettings,\r\n                [selectedSettingsName]: selected,\r\n            },\r\n        });\r\n    };\r\n\r\n    handleDelete = () => {\r\n        this.props.removeRule(this.props.selectedRule.id);\r\n        this.handleCloseConfirmRemoveDialog();\r\n    };\r\n\r\n    handleCloseConfirmRemoveDialog = () => {\r\n        this.setState({isConfirmRemoveDialogOpen: false});\r\n    };\r\n\r\n    handleSearch = event => {\r\n        const matchedRules = this.props.rules.filter(rule =>\r\n            rule.name.toLowerCase().includes(event.target.value.toLowerCase()));\r\n\r\n        this.setState({\r\n            filteredRules: matchedRules || [],\r\n            searchedValue: event.target.value,\r\n        });\r\n    };\r\n\r\n    toggleSearch = async () => {\r\n        await this.setState({isSearchActive: !this.state.isSearchActive});\r\n    };\r\n\r\n    createSettingsModal = () => {\r\n        if (!this.state.isSettingsDialogOpen) {\r\n            return null;\r\n        }\r\n\r\n        const { t } = I18n;\r\n        const options = ['en', 'de', 'ru'];\r\n        const { classes } = this.props;\r\n\r\n        const handleClose = () => {\r\n            this.setState({\r\n                isSettingsDialogOpen: false,\r\n                isSettingsWasNotSaved: true,\r\n            });\r\n        };\r\n\r\n        const submitSettings = () => this.props.saveSettings(this.state.localSettings, handleClose);\r\n\r\n        const handleChange = (event, name) => {\r\n            let value = event.target.checked !== undefined ? event.target.checked : event.target.value;\r\n            if (name === 'language' && value === 'system') {\r\n                value = '';\r\n            }\r\n\r\n            this.setState({\r\n                localSettings: {\r\n                    ...this.state.localSettings,\r\n                    [name]: value,\r\n                },\r\n            });\r\n        };\r\n\r\n        return <Dialog\r\n            open={this.state.isSettingsDialogOpen}\r\n            onClose={handleClose}\r\n            fullWidth\r\n            onExited={this.getDefaultSettings}>\r\n            <DialogTitle>\r\n                <Typography variant=\"h4\" component=\"span\" align=\"center\">\r\n                    {t('Settings')}\r\n                </Typography>\r\n            </DialogTitle>\r\n            <DialogContent>\r\n                <form noValidate autoComplete=\"off\">\r\n                    <Grid container direction=\"column\">\r\n                        <Grid item>\r\n                            <FormControl fullWidth classes={{ root: classes.settingsItem }}>\r\n                            <InputLabel id=\"demo-simple-select-label\">{t('Language')}</InputLabel>\r\n                            <Select\r\n                                classes={{ root: classes.width100 }}\r\n                                onChange={event => handleChange(event, 'language')}\r\n                                value={\r\n                                    !this.state.localSettings.language\r\n                                        ? 'system'\r\n                                        : this.state.localSettings.language\r\n                                }>\r\n                                <MenuItem value=\"system\">{t('System')}</MenuItem>\r\n                                {Children.toArray(\r\n                                    options.map(option => (\r\n                                        <MenuItem value={option}>{t('lang_' + option)}</MenuItem>\r\n                                    ))\r\n                                )}\r\n                            </Select>\r\n                        </FormControl>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <FormControl fullWidth classes={{ root: clsx(classes.settingsItem, classes.selectIdText) }}>\r\n                                <TextField\r\n                                    label={t('Answer in id')}\r\n                                    value={this.state.localSettings.sayitInstance}\r\n                                    onChange={event => handleChange(event, 'sayitInstance')}\r\n                                />\r\n                            </FormControl>\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                className={classes.selectIdButton}\r\n                                onClick={() =>\r\n                                    this.setState({\r\n                                        showDialogSelectId: true,\r\n                                        selectedSettingsName: 'sayitInstance',\r\n                                        selectedId: this.state.localSettings.sayitInstance || '',\r\n                                    })}\r\n                            >...</Button>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <FormControl fullWidth classes={{ root: clsx(classes.settingsItem, classes.selectIdText) }}>\r\n                                <TextField\r\n                                    label={t(`Processor's id`)}\r\n                                    value={this.state.localSettings.processorId}\r\n                                    onChange={event => handleChange(event, 'processorId')}\r\n                                />\r\n                            </FormControl>\r\n                            <Button\r\n                                variant=\"outlined\"\r\n                                className={classes.selectIdButton}\r\n                                onClick={() =>\r\n                                    this.setState({\r\n                                        showDialogSelectId: true,\r\n                                        selectedSettingsName: 'processorId',\r\n                                        selectedId: this.state.localSettings.processorId || '',\r\n                                    })}\r\n                            >...</Button>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <FormControl fullWidth classes={{ root: classes.settingsItem }}>\r\n                            <TextField\r\n                                label={t('Timeout for processor')}\r\n                                helperText={t('ms')}\r\n                                value={this.state.localSettings.processorTimeout}\r\n                                onChange={e => handleChange(e, 'processorTimeout')}\r\n                            />\r\n                        </FormControl>\r\n                        </Grid>\r\n                        <Grid item>\r\n                            <FormControl fullWidth classes={{ root: classes.settingsItem }}>\r\n                        <FormControlLabel\r\n                            control={<Checkbox checked={this.state.localSettings.writeEveryAnswer} onChange={e => handleChange(e, 'writeEveryAnswer')} />}\r\n                            label={t('Write to response by every command')}\r\n                        />\r\n                    </FormControl>\r\n                        </Grid>\r\n                    </Grid>\r\n                </form>\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button variant=\"contained\" color=\"primary\" onClick={submitSettings} startIcon={<CheckIcon/>}>{I18n.t('Ok')}</Button>\r\n                <Button variant=\"contained\" onClick={handleClose}startIcon={<CloseIcon/>}>{I18n.t('Cancel')}</Button>\r\n            </DialogActions>\r\n        </Dialog>;\r\n    };\r\n\r\n    mainIcons = [\r\n        {\r\n            icon: <AddIcon />,\r\n            handler: () => this.props.handleOpen(),\r\n            tooltip: I18n.t('Create rule'),\r\n        },\r\n        {\r\n            icon: <SettingsIcon />,\r\n            handler: () => this.handleOpenSettingsModal(),\r\n            tooltip: I18n.t('Settings'),\r\n        },\r\n        {\r\n            icon: <CachedIcon />,\r\n            handler: () => console.log('refresh'),\r\n            tooltip: I18n.t('Refresh'),\r\n        },\r\n    ];\r\n\r\n    createIcons = iconsData =>\r\n        iconsData.map(({ icon, handler, tooltip }, index) => (\r\n            <CustomTooltip title={tooltip} key={index}>\r\n                <IconButton onClick={handler}>{icon}</IconButton>\r\n            </CustomTooltip>\r\n        ));\r\n\r\n    renderSelectIdDialog() {\r\n        return this.state.showDialogSelectId ? (\r\n            <DialogSelectID\r\n                imagePrefix={'../..'}\r\n                socket={this.props.socket}\r\n                title={'Select ID'}\r\n                selected={this.state.selectedId}\r\n                onClose={() => this.setState({ showDialogSelectId: false })}\r\n                onOk={selected => this.handleDialogSelectIdSubmit(selected, this.state.selectedSettingsName)}\r\n            />\r\n        ) : null;\r\n    }\r\n\r\n    renderConfirmDialog() {\r\n        return this.state.isConfirmRemoveDialogOpen ?\r\n            <Dialog\r\n                open={this.state.isConfirmRemoveDialogOpen}\r\n                onClose={this.handleCloseConfirmRemoveDialog}\r\n                fullWidth>\r\n                <DialogTitle>{I18n.t('Are you sure?')}</DialogTitle>\r\n                <DialogContent>\r\n                    <Typography component=\"p\">\r\n                        {I18n.t('You want to delete: %s', this.props.selectedRule.name)}\r\n                    </Typography>\r\n                    <DialogActions>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            color=\"primary\"\r\n                            autoFocus\r\n                            onClick={this.handleDelete}\r\n                            startIcon={<DeleteIcon/>}\r\n                        >{I18n.t('Delete')}</Button>\r\n                        <Button\r\n                            variant=\"contained\"\r\n                            onClick={this.handleCloseConfirmRemoveDialog}\r\n                                startIcon={<CloseIcon/>}\r\n                                >\r\n                            {I18n.t('Cancel')}\r\n                        </Button>\r\n                    </DialogActions>\r\n                </DialogContent>\r\n            </Dialog>\r\n         : null;\r\n    }\r\n\r\n    renderToast() {\r\n        if (this.state.toast) {\r\n            return <Snackbar\r\n                anchorOrigin={{\r\n                    vertical: 'top',\r\n                    horizontal: 'right',\r\n                }}\r\n                open={true}\r\n                autoHideDuration={4000}\r\n                onClose={() => this.setState({toast: ''})}\r\n            >\r\n                {\r\n                    this.state.toastError ?\r\n                        <Alert elevation={6} variant=\"filled\" onClose={() => this.setState({toast: ''})} severity=\"error\">{this.state.toast}</Alert>\r\n                        :\r\n                        <Alert elevation={6} variant=\"filled\" onClose={() => this.setState({toast: ''})} severity=\"success\">{this.state.toast}</Alert>\r\n                }\r\n            </Snackbar>\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    render() {\r\n        const {\r\n            selectedRule,\r\n            moveRule,\r\n            handleEdit,\r\n            handleCopy,\r\n            rules,\r\n            selectRule,\r\n            classes,\r\n            isMobile,\r\n            closeDrawer,\r\n        } = this.props;\r\n\r\n        const { filteredRules, isSearchActive, searchedValue } = this.state;\r\n        const settingsDialog = this.createSettingsModal();\r\n        const renderedRules = isSearchActive && searchedValue.length ? filteredRules : rules;\r\n        const additionalIcons = [];\r\n\r\n        selectedRule &&\r\n            selectedRule.id &&\r\n            additionalIcons.push({\r\n                icon: !isSearchActive && <DeleteIcon />,\r\n                handler: () =>\r\n                    this.setState({isConfirmRemoveDialogOpen: true,}),\r\n                tooltip: I18n.t('Remove rule'),\r\n                key: 'delete',\r\n            });\r\n\r\n        rules.length &&\r\n            additionalIcons.push({\r\n                icon: isSearchActive ? <FormatClearIcon /> : <SearchIcon />,\r\n                handler: () => this.toggleSearch(),\r\n                tooltip: I18n.t('Search rule'),\r\n                key: 'search',\r\n            });\r\n\r\n        return <Box className={classes.main}>\r\n            <Toolbar position=\"static\" variant=\"dense\" classes={{ root: classes.toolbar }} disableGutters>\r\n                {isSearchActive ?\r\n                    <TextField\r\n                        className={classes.search}\r\n                        onChange={this.handleSearch}\r\n                        value={this.state.searchedValue}\r\n                        InputProps={{\r\n                            endAdornment: this.state.searchedValue ? (\r\n                                <IconButton\r\n                                    onClick={() => this.setState({ searchedValue: '' })}>\r\n                                    <ClearIcon />\r\n                                </IconButton>\r\n                            ) : undefined,\r\n                        }}\r\n                        autoFocus\r\n                    />\r\n                 : <div>{this.createIcons(this.mainIcons)}</div>}\r\n                <div>{this.createIcons(additionalIcons)}</div>\r\n                {isMobile && (\r\n                    <IconButton className={classes.closeBtn} onClick={closeDrawer}>\r\n                        <CloseIcon />\r\n                    </IconButton>\r\n                )}\r\n                {!isSearchActive && !this.state.alive ? <div style={{flexGrow: 1}}/> : null}\r\n                {!isSearchActive && !this.state.alive ? <Tooltip title={I18n.t('Instance is not running')}><WarningIcon className={classes.iconNotAlive}/></Tooltip> : null}\r\n            </Toolbar>\r\n\r\n            <DndProvider backend={HTML5Backend}>\r\n                <List className={classes.list}>\r\n                    {renderedRules.map((rule, index) => (\r\n                        <Rule\r\n                            theme={this.props.theme}\r\n                            handleEdit={handleEdit}\r\n                            handleCopy={handleCopy}\r\n                            unique={rule.unique}\r\n                            {...rule}\r\n                            index={index}\r\n                            moveRule={moveRule}\r\n                            key={rule.id}\r\n                            selectRule={selectRule}\r\n                            selectedRule={selectedRule}\r\n                            matchingRules={this.state.matchingRules}\r\n                            unsavedRules={this.props.unsavedRules}\r\n                            removeMatched={this.removeMatched}\r\n                        />\r\n                    ))}\r\n                </List>\r\n            </DndProvider>\r\n\r\n            <Toolbar className={classes.test} variant=\"dense\" disableGutters>\r\n                <TextField\r\n                    onChange={this.handleTextCommand}\r\n                    label={I18n.t('Test phrase')}\r\n                    variant=\"outlined\"\r\n                    size=\"small\"\r\n                    color=\"primary\"\r\n                    className={clsx('outlined-basic', classes.root)}\r\n                    onKeyDown={this.handleSubmit}\r\n                    value={this.state.textCommand}\r\n                    inputProps={{style: {padding: '10px 10px'}}}\r\n                    InputProps={{\r\n                        endAdornment: this.state.textCommand ? (\r\n                            <IconButton onClick={() => this.setState({ textCommand: '' })}>\r\n                                <ClearIcon />\r\n                            </IconButton>\r\n                        ) : undefined,\r\n                    }}\r\n                />\r\n                <IconButton\r\n                    variant=\"outlined\"\r\n                    onClick={event => this.handleSubmit(event, true)}>\r\n                    <PlayArrowIcon className={classes.play} />\r\n                </IconButton>\r\n            </Toolbar>\r\n\r\n            {settingsDialog}\r\n\r\n            {this.renderConfirmDialog()}\r\n            {this.renderSelectIdDialog()}\r\n            {this.renderToast()}\r\n        </Box>;\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(Drawer);\r\n\r\nDrawer.propTypes = {\r\n    handleOpen: PropTypes.func.isRequired,\r\n    themeType: PropTypes.string,\r\n    rules: PropTypes.arrayOf(\r\n        PropTypes.shape({\r\n            id: PropTypes.string,\r\n        })\r\n    ),\r\n    instance: PropTypes.number.isRequired,\r\n    moveRule: PropTypes.func.isRequired,\r\n    selectRule: PropTypes.func.isRequired,\r\n    theme: PropTypes.object.isRequired,\r\n    selectedRule: PropTypes.shape({id: PropTypes.string}),\r\n    removeRule: PropTypes.func,\r\n    handleEdit: PropTypes.func.isRequired,\r\n    handleCopy: PropTypes.func.isRequired,\r\n    classes: PropTypes.object.isRequired,\r\n    settings: PropTypes.object,\r\n    socket: PropTypes.object.isRequired,\r\n    saveSettings: PropTypes.func.isRequired,\r\n    unsavedRules: PropTypes.object,\r\n    toggleLeftBar: PropTypes.func,\r\n    isMobile: PropTypes.bool.isRequired,\r\n    closeDrawer: PropTypes.func,\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport clsx from 'clsx';\r\n\r\nimport {TextField, Switch, Typography, withStyles, Box, FormLabel} from '@material-ui/core';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Button from '@material-ui/core/Button';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\n\r\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport CheckIcon from '@material-ui/icons/Check';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\n\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\nimport DialogSelectID from '@iobroker/adapter-react/Dialogs/SelectID';\r\nimport isEqual from 'lodash.isequal';\r\n\r\nconst styles = theme => ({\r\n    root: {\r\n        width: '100%',\r\n        height: '100%',\r\n        padding: 0,\r\n        margin: 0,\r\n        position: 'relative',\r\n    },\r\n    box: {\r\n        display: 'inline-flex',\r\n        justifyContent: 'space-around',\r\n        position: 'relative',\r\n        '& .outlined-basic': {\r\n            padding: '12px 10px',\r\n            //border: `2px solid ${theme.palette.grey[700]}`,\r\n        },\r\n        [theme.breakpoints.down('md')]: {\r\n            '& .outlined-basic': {\r\n                padding: 0,\r\n            },\r\n        },\r\n    },\r\n    boxMobile: {\r\n        padding: 0,\r\n        width: '100%',\r\n        height: 'calc(100% - 48px - 48px)',\r\n        overflow: 'auto'\r\n    },\r\n    boxDesktop: {\r\n        padding: theme.spacing(1),\r\n        width: 'calc(100% - ' + theme.spacing(2) + 'px)',\r\n        height: 'calc(100% - 48px - 48px - ' + theme.spacing(2) + 'px)',\r\n        overflow: 'auto'\r\n    },\r\n    container: {\r\n        width: '100%',\r\n        padding: theme.spacing(2),\r\n        overflow: 'auto',\r\n        [theme.breakpoints.down('md')]: {\r\n            width: 'calc(100% - ' + theme.spacing(3) + 'px)',\r\n            padding: theme.spacing(1),\r\n        },\r\n    },\r\n    /*textField: {\r\n        flexBasis: '60%',\r\n        [theme.breakpoints.down('sm')]: {\r\n            width: '100%',\r\n            marginTop: theme.spacing(1),\r\n        },\r\n    },*/\r\n    submitForm: {\r\n        flexDirection: 'row',\r\n        //margin: '10px auto 20px',\r\n        display: 'flex',\r\n        justifyContent: 'right',\r\n        width: '100%',\r\n        [theme.breakpoints.down('xs')]: {\r\n            flexDirection: 'column',\r\n        },\r\n    },\r\n    mainTitle: {\r\n        marginBottom: '30px',\r\n    },\r\n    rowSpace: {\r\n        marginBottom: 16,\r\n    },\r\n    title: {\r\n        whiteSpace: 'nowrap'\r\n    },\r\n    row: {\r\n        [theme.breakpoints.down('md')]: {\r\n            alignItems: 'center',\r\n        },\r\n        [theme.breakpoints.down('sm')]: {\r\n            flexDirection: 'column',\r\n            alignItems: 'flex-start',\r\n            textAlign: 'center',\r\n        },\r\n    },\r\n    btnDanger: {\r\n        marginLeft: 8,\r\n        [theme.breakpoints.down('xs')]: {\r\n            marginLeft: 0,\r\n            marginTop: theme.spacing(0.5),\r\n        },\r\n        //backgroundColor: theme.palette.error?.dark,\r\n    },\r\n    saveAndGoBtn: {\r\n        marginRight: 20,\r\n        [theme.breakpoints.down('xs')]: {\r\n            marginRight: 0,\r\n            marginBottom: theme.spacing(0.5),\r\n        },\r\n    },\r\n    toggleIcon: {\r\n        position: 'absolute',\r\n        zIndex: 1,\r\n        opacity: 0.8,\r\n        top: 8,\r\n        left: 0,\r\n        backgroundColor: theme.palette.primary.main,\r\n        width: 18,\r\n        height: 25,\r\n        cursor: 'pointer',\r\n        padding: '4px 8px 4px 2px',\r\n        color: '#FFF',\r\n        borderRadius: '0 5px 5px 0',\r\n    },\r\n    switchControl: {\r\n        //paddingTop: theme.spacing(1),\r\n        //flexBasis: '60%',\r\n        marginTop: -5,\r\n    },\r\n    emptyButtons: {\r\n        [theme.breakpoints.down('sm')]: {\r\n            height: 0,\r\n        },\r\n    },\r\n    noRulesText: {\r\n        fontSize: 24,\r\n        color: theme.palette.primary.light\r\n    },\r\n    header: {\r\n        backgroundColor: theme.palette.secondary.main,\r\n        fontSize: 18,\r\n        fontWeight: 'bold',\r\n        paddingLeft: 40,\r\n        zIndex: 0,\r\n        color: '#FFF',\r\n    },\r\n    inputOid: {\r\n        width: 'calc(100% - 60px)',\r\n        display: 'inline-block'\r\n    },\r\n    inputOidButton: {\r\n        minWidth: 40,\r\n        display: 'inline-block',\r\n        marginLeft: 8\r\n    },\r\n    textField: {\r\n        width: 'calc(100% - 12px)',\r\n    },\r\n    rowPadding: {\r\n        marginBottom: theme.spacing(1),\r\n    }\r\n});\r\n\r\nclass RuleEditor extends PureComponent {\r\n    defaultState = {\r\n        words: I18n.t('Create Rule'),\r\n        name: I18n.t('Create Rule'),\r\n        _break: false,\r\n        editable: false,\r\n        args: [\r\n            {\r\n                default: I18n.t('Argument') + ' 1',\r\n            },\r\n            {\r\n                default: I18n.t('Argument') + ' 2',\r\n            },\r\n        ],\r\n        ack: {\r\n            name: '',\r\n            default: `${I18n.t('Confirmation text')}`,\r\n        },\r\n        id: 0,\r\n    };\r\n\r\n    state = {\r\n        localRule: null,\r\n        showDialog: false,\r\n    };\r\n\r\n    static getDerivedStateFromProps(props, state) {\r\n        if ((!props.selectedRule && state.localRule) ||\r\n            (props.selectedRule && !state.localRule) ||\r\n            (props.selectedRule?.id !== state.localRule?.id)) {\r\n            return {\r\n                localRule: {...props.selectedRule}\r\n            };\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState) {\r\n        if (\r\n            prevProps.selectedRule?.name !== this.props.selectedRule?.name ||\r\n            prevState.localRule?.name !== this.state.localRule?.name\r\n        ) {\r\n            if (!this.props.selectedRule || !this.props.selectedRule.name) {\r\n                this.setState({\r\n                    localRule: null,\r\n                });\r\n            } else {\r\n                this.setState({\r\n                    localRule: {\r\n                        ...this.props.selectedRule,\r\n                    },\r\n                });\r\n            }\r\n        } else if (this.state.isLocalStateWasUpdated) {\r\n            const unsavedRule = this.props.unsavedRules[this.state.localRule.id];\r\n\r\n            if (\r\n                isEqual(this.props.selectedRule, this.state.localRule) &&\r\n                !unsavedRule?.wasChangedGlobally\r\n            ) {\r\n                this.setState({isLocalStateWasUpdated: false});\r\n\r\n                if (!unsavedRule?.wasChangedGlobally) {\r\n                    this.props.removeUnsavedRule(this.state.localRule.id);\r\n                }\r\n            } else if (!unsavedRule && !this.props.pendingSelectedRuleId) {\r\n                this.props.setUnsavedRule(this.state.localRule.id);\r\n            }\r\n        } else if (\r\n            !this.state.isLocalStateWasUpdated &&\r\n            this.props.unsavedRules[this.state.localRule.id]\r\n        ) {\r\n            this.setState({isLocalStateWasUpdated: true});\r\n        }\r\n\r\n        if (this.props.pendingSelectedRuleId && this.state.isLocalStateWasUpdated) {\r\n            if (this.props.pendingSelectedRuleId === this.state.localRule.id) {\r\n                return;\r\n            }\r\n            this.setState({confirmChanges: true});\r\n        }\r\n\r\n        if (this.props.lang !== prevProps.lang) {\r\n            this.forceUpdate();\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        if (!this.state.localRule && this.props.selectedRule) {\r\n            this.setState({\r\n                localRule: this.props.selectedRule,\r\n            });\r\n        }\r\n    }\r\n\r\n    createConfirmModalActions = () => {\r\n        const { t } = I18n;\r\n        const {\r\n            updateConfig,\r\n            classes,\r\n            selectRule,\r\n            pendingSelectedRuleId,\r\n            clearStateOnConfirmModalUnmount,\r\n            revertChangesFromConfig,\r\n        } = this.props;\r\n        const { localRule } = this.state;\r\n\r\n        const cancelSavingChanges = async () => {\r\n            await clearStateOnConfirmModalUnmount();\r\n            this.closeConfirmDialog();\r\n        };\r\n\r\n        const dontSaveAndGo = async () => {\r\n            await revertChangesFromConfig(localRule);\r\n            await selectRule(pendingSelectedRuleId);\r\n            await clearStateOnConfirmModalUnmount(localRule.id);\r\n\r\n            this.closeConfirmDialog();\r\n        };\r\n        const handleSaveAndGo = async () => {\r\n            await updateConfig(localRule);\r\n            await selectRule(pendingSelectedRuleId);\r\n            await clearStateOnConfirmModalUnmount();\r\n\r\n            this.closeConfirmDialog();\r\n        };\r\n        return <FormControl className={classes.submitForm}>\r\n            <div style={{flexGrow: 1}}/>\r\n            <Button\r\n                variant=\"contained\"\r\n                onClick={handleSaveAndGo}\r\n                color=\"primary\"\r\n                startIcon={<CheckIcon/>}\r\n                className={classes.saveAndGoBtn}>\r\n                {t('Save and go')}\r\n            </Button>\r\n            <Button onClick={dontSaveAndGo} variant=\"contained\" color=\"secondary\"\r\n                    startIcon={<CheckIcon/>}\r\n            >\r\n                {t(`Don't save and go`)}\r\n            </Button>\r\n            <Button\r\n                variant=\"contained\"\r\n                className={classes.btnDanger}\r\n                startIcon={<CloseIcon/>}\r\n                onClick={cancelSavingChanges}>\r\n                {t('Cancel')}\r\n            </Button>\r\n        </FormControl>;\r\n    };\r\n\r\n    createSaveSettingsForm = () => {\r\n        const { t } = I18n;\r\n        const { updateConfig, classes, revertChangesFromConfig, selectedRule } = this.props;\r\n        const { localRule } = this.state;\r\n\r\n        const handleSave = async () => {\r\n            await updateConfig(localRule);\r\n            this.setState({isLocalStateWasUpdated: false});\r\n        };\r\n\r\n        const revertChanges = async () => {\r\n            await revertChangesFromConfig(localRule);\r\n\r\n            await this.setState({\r\n                localRule: selectedRule,\r\n                isLocalStateWasUpdated: false,\r\n            });\r\n        };\r\n\r\n        if (!this.state.isLocalStateWasUpdated) {\r\n            return <div className={this.props.classes.emptyButtons} />;\r\n        } else {\r\n            return <FormControl className={classes.submitForm}>\r\n                <div style={{flexGrow: 1}}/>\r\n                <Button\r\n                    onClick={handleSave}\r\n                    variant=\"contained\"\r\n                    startIcon={<CheckIcon/>}\r\n                    color=\"primary\">\r\n                    {t('Save')}\r\n                </Button>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    className={classes.btnDanger}\r\n                    startIcon={<CloseIcon/>}\r\n                    onClick={revertChanges}>\r\n                    {t('Cancel')}\r\n                </Button>\r\n            </FormControl>;\r\n        }\r\n    };\r\n\r\n    closeConfirmDialog = () => {\r\n        this.setState({\r\n            isLocalStateWasUpdated: false,\r\n            confirmChanges: false,\r\n        });\r\n    };\r\n\r\n    createInput = ({\r\n        value,\r\n        label,\r\n        onChange,\r\n        type,\r\n        onOpenSelectDialog,\r\n        note,\r\n        disabled = !this.state.localRule,\r\n        keywords,\r\n        key,\r\n        onSwitchChange,\r\n        isMobile,\r\n    }) => {\r\n        if ((value === undefined || value === null) && !label && !keywords) {\r\n            return null;\r\n        }\r\n        const { classes } = this.props;\r\n\r\n        if (onOpenSelectDialog) {\r\n            return <div>\r\n                <TextField\r\n                    classes={{root: classes.inputOid}}\r\n                    fullWidth\r\n                    label={isMobile ? label : ''}\r\n                    //variant=\"outlined\"\r\n                    size=\"small\"\r\n                    disabled={disabled}\r\n                    value={value}\r\n                    helperText={note || ''}\r\n                    onChange={onChange}\r\n                    key={key}\r\n                />\r\n                <Button onClick={() => onOpenSelectDialog(value)} size=\"small\" className={classes.inputOidButton}\r\n                        variant=\"outlined\"\r\n                >...</Button>\r\n            </div>\r\n        } else if (type !== 'checkbox') {\r\n            return <TextField\r\n                classes={{root: classes.textField}}\r\n                label={isMobile ? label : ''}\r\n                //variant=\"outlined\"\r\n                size=\"small\"\r\n                disabled={disabled}\r\n                value={value}\r\n                helperText={note || ''}\r\n                onChange={onChange}\r\n                key={key}\r\n                className={classes.rowPadding}\r\n                //className={clsx('outlined-basic', classes.textField)}\r\n            />;\r\n        } else {\r\n            return <FormControl classes={{ root: classes.switchControl }}>\r\n                <Switch\r\n                    key={key}\r\n                    onClick={onSwitchChange}\r\n                    color={'primary'}\r\n                    disabled={disabled}\r\n                    checked={!!value}\r\n                />\r\n                {isMobile ? <FormLabel>{label}</FormLabel> : null}\r\n            </FormControl>;\r\n        }\r\n    };\r\n\r\n    createOptionsData = (state = this.state) => {\r\n        const {localRule: { args, ack, editable, _break }} = state;\r\n        const { t } = I18n;\r\n\r\n        const createInput = this.createInput;\r\n        const handlers = this.handlers;\r\n\r\n        const isKeyWordsDisabled = () => {\r\n            if (editable === undefined) {\r\n                return false;\r\n            } else if (editable === false) {\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n\r\n        return [\r\n            {\r\n                title: t('Keywords'),\r\n                item: createInput({\r\n                    value: this.state.localRule?.words || '',\r\n                    onChange: handlers.keywordsText,\r\n                    keywords: true,\r\n                    disabled: isKeyWordsDisabled(),\r\n                    key: 'keywords',\r\n                    label: t('Keywords'),\r\n                    isMobile: this.props.isMobile,\r\n                }),\r\n                id: 1,\r\n            },\r\n            {\r\n                title: t('Interrupt processing'),\r\n                item: createInput({\r\n                    type: 'checkbox',\r\n                    value: _break,\r\n                    onSwitchChange: handlers.breakOnSwitch,\r\n                    key: 'break',\r\n                    label: t('Interrupt processing'),\r\n                    isMobile: this.props.isMobile,\r\n                }),\r\n                id: 2,\r\n            },\r\n            {\r\n                title: args && args[0]?.name, //`${t('Argument')}:`,\r\n                item: createInput({\r\n                    value: args && this.state.localRule.args[0]?.default,\r\n                    type: args && args[0]?.type,\r\n                    onOpenSelectDialog: selectedId => this.openSelectIdDialog(args && args[0], selectedId),\r\n                    onSwitchChange: handlers.param1OnSwitch,\r\n                    key: 'Param1',\r\n                    label: args && args[0]?.name, //`${t('Argument')}:`,\r\n                    isMobile: this.props.isMobile,\r\n                }),\r\n                id: 3,\r\n            },\r\n            {\r\n                title: args && args[1]?.name, //`${t('Argument')}:`,\r\n                item: createInput({\r\n                    value: args && this.state.localRule.args[1]?.default,\r\n                    type: args && args[1]?.type,\r\n                    onChange: handlers.param2Text,\r\n                    onSwitchChange: handlers.param2OnSwitch,\r\n                    key: 'Param2',\r\n                    label: args && args[1]?.name, //`${t('Argument')}:`,\r\n                    isMobile: this.props.isMobile,\r\n                }),\r\n                id: 4,\r\n            },\r\n            {\r\n                title: t('Confirmation text'),\r\n                item: createInput({\r\n                    value: ack && ack.default,\r\n                    //label: ack && ack.name,\r\n                    note: t('You can use %s, that will be replaced with current value of state. %u will be replaced by unit'),\r\n                    type: ack && ack.type,\r\n                    key: 'confirmationText',\r\n                    onChange: handlers.confirmText,\r\n                    onSwitchChange: handlers.confirmOnSwitch,\r\n                    label: t('Confirmation text'),\r\n                    isMobile: this.props.isMobile,\r\n                }),\r\n                id: 5,\r\n            },\r\n        ];\r\n    };\r\n\r\n    createInputHandlers = () => {\r\n        const _this = this;\r\n\r\n        return {\r\n            keywordsText(event) {\r\n                _this.setState({\r\n                    localRule: {\r\n                        ..._this.state.localRule,\r\n                        words: event.target.value,\r\n                    },\r\n                    isLocalStateWasUpdated: true,\r\n                });\r\n            },\r\n            param2Text(event) {\r\n                _this.setState({\r\n                    localRule: {\r\n                        ..._this.state.localRule,\r\n                        args: _this.state.localRule.args.map((arg, index) =>\r\n                            index > 0\r\n                                ? {\r\n                                      ...arg,\r\n                                      default: event.target.value,\r\n                                  }\r\n                                : arg\r\n                        ),\r\n                    },\r\n                    isLocalStateWasUpdated: true,\r\n                });\r\n            },\r\n            confirmText(event) {\r\n                _this.setState({\r\n                    localRule: {\r\n                        ..._this.state.localRule,\r\n                        ack: {\r\n                            ..._this.state.localRule.ack,\r\n                            default: event.target.value,\r\n                        },\r\n                    },\r\n                    isLocalStateWasUpdated: true,\r\n                });\r\n            },\r\n            param1OnSwitch() {\r\n                _this.setState({\r\n                    localRule: {\r\n                        ..._this.state.localRule,\r\n                        args: _this.state.localRule.args.map((arg, index) =>\r\n                            !index ? { ...arg, default: !arg.default ? true : !arg.default } : arg\r\n                        ),\r\n                    },\r\n                    isLocalStateWasUpdated: true,\r\n                });\r\n            },\r\n            param2OnSwitch() {\r\n                _this.setState({\r\n                    localRule: {\r\n                        ..._this.state.localRule,\r\n                        args: _this.state.localRule.args.map((arg, index) =>\r\n                            index ? { ...arg, default: !arg.default ? true : !arg.default } : arg\r\n                        ),\r\n                    },\r\n                    isLocalStateWasUpdated: true,\r\n                });\r\n            },\r\n            confirmOnSwitch() {\r\n                _this.setState({\r\n                    localRule: {\r\n                        ..._this.state.localRule,\r\n                        ack: {\r\n                            ..._this.state.localRule.ack,\r\n                            default: !_this.state.localRule.ack.default,\r\n                        },\r\n                    },\r\n                    isLocalStateWasUpdated: true,\r\n                });\r\n            },\r\n            async breakOnSwitch() {\r\n                await _this.setState({\r\n                    localRule: {\r\n                        ..._this.state.localRule,\r\n                        _break: !_this.state.localRule._break,\r\n                    },\r\n                    isLocalStateWasUpdated: true,\r\n                });\r\n            },\r\n        };\r\n    };\r\n\r\n    handlers = this.createInputHandlers();\r\n\r\n    openSelectIdDialog = (arg, selectedId) => {\r\n        if (arg.type === 'id') {\r\n            this.setState({showDialog: true, showDialogId: selectedId});\r\n        }\r\n    };\r\n\r\n    onIDSelected = selected => {\r\n        this.setState({\r\n            localRule: {\r\n                ...this.state.localRule,\r\n                args: this.state.localRule.args.map((arg, index) =>\r\n                    !index\r\n                        ? {\r\n                              ...arg,\r\n                              default: selected,\r\n                          }\r\n                        : arg\r\n                ),\r\n            },\r\n            isLocalStateWasUpdated: true,\r\n        });\r\n    };\r\n\r\n    renderConfirmDialog() {\r\n        return this.state.confirmChanges ? (\r\n            <Dialog fullWidth open={this.state.confirmChanges} maxWidth={'md'}>\r\n                <DialogTitle>\r\n                    {I18n.t('Please confirm or cancel changes before leaving')}\r\n                </DialogTitle>\r\n                <DialogContent>\r\n                    <Typography>\r\n                        {I18n.t('You have changed rule') + ': '}{' '}\r\n                        <strong>{this.state.localRule.name}</strong>\r\n                    </Typography>\r\n                    <DialogActions>{this.createConfirmModalActions()}</DialogActions>\r\n                </DialogContent>\r\n            </Dialog>\r\n        ) : null;\r\n    }\r\n\r\n    renderSelectIdDialog() {\r\n        return this.state.showDialog ?\r\n            <DialogSelectID\r\n                imagePrefix={'../..'}\r\n                socket={this.props.socket}\r\n                title={'Select ID'}\r\n                selected={this.state.showDialogId}\r\n                onClose={() => this.setState({ showDialog: false })}\r\n                onOk={id => this.onIDSelected(id)}\r\n            />: null;\r\n    }\r\n\r\n    render() {\r\n        const {localRule} = this.state;\r\n\r\n        const { classes, isLeftBarOpen, toggleLeftBar } = this.props;\r\n        const name = localRule ? localRule.name : '';\r\n\r\n        if (!this.props.selectedRule) {\r\n            return null;\r\n        }\r\n\r\n        return <div className={classes.root}>\r\n            <Box className={classes.toggleIcon} onClick={toggleLeftBar}>\r\n                {isLeftBarOpen || this.props.isMobile ? <MenuIcon /> : <ArrowBackIcon />}\r\n            </Box>\r\n            <Toolbar position=\"static\" variant=\"dense\" className={this.props.classes.header}>\r\n                {name}\r\n            </Toolbar>\r\n\r\n            <Box className={clsx(classes.box, this.props.isMobile ? classes.boxMobile : classes.boxDesktop)} key={this.props.selectedRule ? this.props.selectedRule.id : 'emptyLeft'}>\r\n                {localRule ?\r\n                    <Paper className={classes.container}>\r\n                        <div style={this.props.isMobile ? {width: '100%'} : {display: 'grid', gridTemplateColumns: 'minmax(50px, 215px) 1fr'}}>\r\n                            {this.createOptionsData().map(({title, item, id}) => {\r\n                                if (!item) {\r\n                                    return null;\r\n                                }\r\n\r\n                                return [\r\n                                    !this.props.isMobile ?<div key={1} className={clsx(classes.title, classes.rowSpace)}>{title}</div> : null,\r\n                                    <div key={2} className={classes.rowSpace}>{item}</div>\r\n                                ];\r\n                            })}\r\n                        </div>\r\n                    </Paper>\r\n                    :\r\n                    null\r\n                }\r\n\r\n                {this.renderSelectIdDialog()}\r\n                {this.renderConfirmDialog()}\r\n            </Box>\r\n\r\n            {localRule ? <Toolbar position=\"static\" variant=\"dense\" className={this.props.classes.header}>\r\n                {this.createSaveSettingsForm()}\r\n            </Toolbar> : null}\r\n\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(RuleEditor);\r\n\r\nRuleEditor.propTypes = {\r\n    selectedRule: PropTypes.shape({\r\n        name: PropTypes.string,\r\n        id: PropTypes.string,\r\n        rule: PropTypes.string,\r\n        ack: PropTypes.shape({\r\n            default: PropTypes.oneOfType([PropTypes.string, PropTypes.bool]),\r\n            value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\r\n        }),\r\n        arg: PropTypes.arrayOf(\r\n            PropTypes.shape({\r\n                name: PropTypes.string,\r\n                type: PropTypes.string,\r\n                default: PropTypes.oneOfType([PropTypes.string, PropTypes.number, PropTypes.bool]),\r\n            })\r\n        ),\r\n        words: PropTypes.string,\r\n    }).isRequired,\r\n    socket: PropTypes.object.isRequired,\r\n    updateConfig: PropTypes.func.isRequired,\r\n    revertChangesFromConfig: PropTypes.func.isRequired,\r\n    classes: PropTypes.object.isRequired,\r\n    selectRule: PropTypes.func.isRequired,\r\n    pendingSelectedRuleId: PropTypes.oneOfType([PropTypes.string, PropTypes.bool]),\r\n    clearStateOnConfirmModalUnmount: PropTypes.func.isRequired,\r\n    unsavedRules: PropTypes.object.isRequired,\r\n    setUnsavedRule: PropTypes.func.isRequired,\r\n    removeUnsavedRule: PropTypes.func.isRequired,\r\n    toggleLeftBar: PropTypes.func.isRequired,\r\n    isLeftBarOpen: PropTypes.bool,\r\n    isMobile: PropTypes.bool.isRequired,\r\n};\r\n","import React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport FormGroup from '@material-ui/core/FormGroup';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport { DialogActions, Button, Select, TextField, MenuItem, withStyles } from '@material-ui/core';\r\n\r\nimport CheckIcon from '@material-ui/icons/Check';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\n\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\n\r\nconst styles = theme => ({\r\n    select: {\r\n        width: '100%',\r\n        marginBottom: theme.spacing(2.5),\r\n    },\r\n    TextField: {\r\n        marginBottom: theme.spacing(1),\r\n    },\r\n});\r\n\r\nclass CreateRuleDialog extends Component {\r\n    defaultRule = {\r\n        rule: I18n.t('Select rule'),\r\n        name: I18n.t('New rule'),\r\n        id: '',\r\n    };\r\n\r\n    state = {\r\n        localRule: this.defaultRule,\r\n        isDisabled: true,\r\n    };\r\n\r\n    componentWillUnmount() {\r\n        this.cleanState();\r\n    }\r\n\r\n    setRuleOnMount = () => {\r\n        const { isEdit, selectedRule } = this.props;\r\n        if (isEdit) {\r\n            this.setState({\r\n                localRule: selectedRule,\r\n            });\r\n        }\r\n    };\r\n\r\n    cleanState = () => {\r\n        if (this.props.isEdit && !this.props.isCopy) {\r\n            this.props.finishEdit(this.state.localRule);\r\n        }\r\n        this.setState({localRule: this.defaultRule});\r\n    };\r\n\r\n    getAvailableOptions = () => {\r\n        const { commands, rules, selectedRule, isEdit } = this.props;\r\n\r\n        const uniqueOptions = commands?.filter(\r\n            option => !(option.unique && rules.find(item => item?.rule === option.rule))\r\n        );\r\n\r\n        return selectedRule?.unique && isEdit ? uniqueOptions.concat(selectedRule) : uniqueOptions;\r\n    };\r\n\r\n    getUniqueName = ruleName => {\r\n        const existingNames = this.props.rules?.map(rule => rule?.name);\r\n\r\n        const matchingNames = existingNames.filter(\r\n            name => name.slice(0, name.length - 2) === ruleName\r\n        );\r\n        const isUnique = this.props.commands.find(\r\n            ({ rule, unique }) => rule === ruleName && unique\r\n        );\r\n\r\n        if (matchingNames.length) {\r\n            let name = matchingNames[matchingNames.length - 1];\r\n            let lastChar = name.slice(name.length - 1);\r\n\r\n            return name.slice(0, name.length - 1) + ++lastChar;\r\n        }\r\n\r\n        return isUnique ? ruleName : `${ruleName} 1`;\r\n    };\r\n\r\n    createForm = disabled => {\r\n        const { localRule } = this.state;\r\n        const { classes } = this.props;\r\n        const commands = this.getAvailableOptions();\r\n        const onSubmitHandler = !this.props.isEdit ? this.props.handleSubmitOnCreate : (this.props.isCopy ? this.props.handleSubmitOnCopy : this.props.handleSubmitOnEdit);\r\n\r\n        const handleSelectChange = event =>\r\n            this.setState({\r\n                localRule: {\r\n                    ...localRule,\r\n                    rule: event.target.value,\r\n                    name: this.getUniqueName(event.target.value),\r\n                    isError: '',\r\n                },\r\n            });\r\n\r\n        const handleInputChange = event => {\r\n            const existingNames = this.props.rules?.map(rule => rule?.name);\r\n\r\n            this.setState({\r\n                localRule: {\r\n                    ...localRule,\r\n                    name: event.target.value,\r\n                    isError: existingNames.includes(event.target.value)\r\n                        ? `${I18n.t('Name already exist')}`\r\n                        : '',\r\n                },\r\n            });\r\n        };\r\n\r\n        return <FormGroup>\r\n            {!this.props.isCopy ? <FormControl fullWidth>\r\n                <InputLabel shrink id=\"rule\">\r\n                    {I18n.t('Rule')}\r\n                </InputLabel>\r\n                <Select\r\n                    onChange={handleSelectChange}\r\n                    value={localRule.rule}\r\n                    labelId={'rule'}\r\n                    className={classes.select}>\r\n                    {commands?.map(option =>\r\n                        <MenuItem key={option.rule} value={option.rule}>\r\n                            {option.rule}\r\n                        </MenuItem>\r\n                    )}\r\n                </Select>\r\n            </FormControl> : null}\r\n            <TextField\r\n                fullWidth\r\n                autoFocus\r\n                id=\"standard-basic\"\r\n                label={this.state.localRule.isError || I18n.t('Name')}\r\n                value={localRule.name}\r\n                onKeyDown={e => {\r\n                    if (e.keyCode === 13 && !disabled) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        onSubmitHandler(\r\n                            this.state.localRule,\r\n                            this.state.localRule.isError\r\n                        );\r\n                    }\r\n                }}\r\n                onChange={handleInputChange}\r\n                error={!!this.state.localRule.isError}\r\n                className={classes.TextField}/>\r\n        </FormGroup>;\r\n    };\r\n\r\n    setDialogContent = () => {\r\n        const { handleClose, handleSubmitOnCreate, handleSubmitOnEdit, isEdit, isCopy, handleSubmitOnCopy } = this.props;\r\n        const onSubmitHandler = !isEdit ? handleSubmitOnCreate : (isCopy ? handleSubmitOnCopy : handleSubmitOnEdit);\r\n        const disabled = !this.state.localRule.name || !this.state.localRule.rule || (this.state.localRule.name === this.defaultRule.name && this.state.localRule.rule === this.defaultRule.rule) ||\r\n        (this.state.localRule.name === this.props.selectedRule?.name && this.state.localRule.rule === this.props.selectedRule?.rule);\r\n        return <DialogContent>\r\n            {this.createForm(disabled, onSubmitHandler)}\r\n            <DialogActions>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    color=\"primary\"\r\n                    onClick={() => onSubmitHandler(\r\n                        this.state.localRule,\r\n                        this.state.localRule.isError\r\n                    )}\r\n                    startIcon={<CheckIcon/>}\r\n                    disabled={disabled}>\r\n                    { I18n.t('Ok') }\r\n                </Button>\r\n                <Button variant=\"contained\" onClick={handleClose} startIcon={<CloseIcon/>}>{I18n.t('Cancel')}</Button>\r\n            </DialogActions>\r\n        </DialogContent>;\r\n    };\r\n\r\n    render() {\r\n        return <Dialog\r\n            open={this.props.isOpen}\r\n            onClose={this.props.handleClose}\r\n            onExited={this.cleanState}\r\n            onEnter={this.setRuleOnMount}\r\n            fullWidth>\r\n            <DialogTitle>\r\n                {I18n.t(!this.props.isEdit ? 'Create new rule' : (this.props.isCopy ? 'Clone rule' : 'Edit rule'))}\r\n            </DialogTitle>\r\n            {this.setDialogContent()}\r\n        </Dialog>;\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(CreateRuleDialog);\r\n\r\nCreateRuleDialog.propTypes = {\r\n    handleClose: PropTypes.func.isRequired,\r\n    handleSubmitOnCreate: PropTypes.func.isRequired,\r\n    handleSubmitOnEdit: PropTypes.func.isRequired,\r\n    handleSubmitOnCopy: PropTypes.func.isRequired,\r\n    isEdit: PropTypes.bool.isRequired,\r\n    commands: PropTypes.arrayOf(\r\n        PropTypes.shape({\r\n            rule: PropTypes.string.isRequired,\r\n            unique: PropTypes.bool.isRequired,\r\n        }).isRequired\r\n    ),\r\n    isOpen: PropTypes.bool.isRequired,\r\n    selectedRule: PropTypes.shape({\r\n        id: PropTypes.string.isRequired,\r\n        name: PropTypes.string.isRequired,\r\n        rule: PropTypes.string.isRequired,\r\n        unique: PropTypes.bool,\r\n    }),\r\n    rules: PropTypes.arrayOf(\r\n        PropTypes.shape({\r\n            id: PropTypes.string.isRequired,\r\n            name: PropTypes.string.isRequired,\r\n            rule: PropTypes.string.isRequired,\r\n            unique: PropTypes.bool,\r\n        })\r\n    ).isRequired,\r\n    finishEdit: PropTypes.func.isRequired,\r\n    classes: PropTypes.object.isRequired,\r\n};\r\n","import React, { PureComponent } from 'react';\r\nimport SplitterLayout from 'react-splitter-layout';\r\nimport { v4 as uuid } from 'uuid';\r\nimport PropTypes from 'prop-types';\r\nimport clsx from 'clsx';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport withWidth from '@material-ui/core/withWidth';\r\nimport 'react-splitter-layout/lib/index.css';\r\n\r\nimport Drawer from '@material-ui/core/Drawer';\r\n\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\n\r\nimport DrawerComponent from './Drawer';\r\nimport RuleEditor from './RuleEditor';\r\nimport CreateRuleDialog from './CreateRuleDialog';\r\nimport isEqual from 'lodash.isequal';\r\n\r\nconst styles = theme => ({\r\n    layout: {\r\n        '& .layout-pane:first': {\r\n            overflow: 'hidden',\r\n        },\r\n    },\r\n    hidden: {\r\n        '& .layout-pane:first-child': {\r\n            width: '0 !important',\r\n        },\r\n        background: theme.palette.background.default,\r\n    },\r\n    opened: {\r\n        '& .layout-pane-primary': {\r\n            width: '',\r\n        },\r\n        overflow: 'hidden',\r\n        background: theme.palette.background.default,\r\n    },\r\n    noRulesText: {\r\n        fontSize: 24,\r\n        color: theme.palette.primary.light,\r\n        textAlign: 'center',\r\n        paddingTop: theme.spacing(2),\r\n    },\r\n});\r\n\r\nclass Layout extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.menuSize = parseFloat(window.localStorage.getItem('App.menuSize')) || 350;\r\n        this.state = {\r\n            rules: [],\r\n            isOpen: false,\r\n            isEdit: false,\r\n            isCopy: false,\r\n            selectedRule: null,\r\n            unsavedRules: {},\r\n            ready: false,\r\n            isLeftBarOpen: window.localStorage.getItem('App.menuHidden') === 'true',\r\n        };\r\n        this.commands = this.getSelectedLanguageCommands();\r\n        this.isMobile = this.props.width === 'sm' || this.props.width === 'xs';\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.getDataFromConfig()\r\n            .then(({ rules, ...settings }) => {\r\n                const rulesWithId = rules.map(rule =>\r\n                    !rule.id || !rule.name\r\n                        ? {\r\n                              ...rule,\r\n                              id: rule.id || uuid(),\r\n                              name: rule.name || window.commands[rule.template]?.name[I18n.getLanguage()] || window.commands[rule.template]?.name.en,\r\n                          }\r\n                        : rule\r\n                );\r\n\r\n                if (!isEqual(rules, rulesWithId)) {\r\n                    this.props.saveConfig({ rules: rulesWithId, ...settings });\r\n                    setTimeout(() => this.setState({rules: rulesWithId}), 50);\r\n                }\r\n            });\r\n\r\n        if (this.isMobile) {\r\n            this.setState({isLeftBarOpen: true});\r\n        }\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState) {\r\n        if (this.state.settings?.language !== this.state.lang && this.state.settings?.language) {\r\n            const lang = this.state.settings?.language;\r\n            I18n.setLanguage(lang);\r\n\r\n            this.commands = this.getSelectedLanguageCommands();\r\n        }\r\n\r\n        if (\r\n            prevState.selectedRule?.id !== this.state.selectedRule?.id &&\r\n            prevState.selectedRule?.id && this.state.selectedRule\r\n        ) {\r\n            localStorage.setItem('selectedRule', this.state.selectedRule.id);\r\n        }\r\n    }\r\n\r\n    getSelectedLanguageCommands = () => {\r\n        const lang = this.state?.settings?.language || I18n.getLanguage();\r\n\r\n        return [\r\n            { rule: I18n.t('Select rule'), unique: false },\r\n            ...Object.entries(window.commands).map(item => {\r\n                const [key, command] = item;\r\n                const { name, ...rest } = command;\r\n                const obj = {\r\n                    ...rest,\r\n                    rule: command?.name[lang],\r\n                    template: key,\r\n                    unique: command.unique,\r\n                    words: command.words && command.words[lang],\r\n                    args: command.args?.map(arg => ({\r\n                        ...arg,\r\n                        name: arg.name[lang] || '',\r\n                        default: arg.default || (arg.type === 'checkbox' ? false : ''),\r\n                    })),\r\n                    ack: command.ack && {\r\n                        ...command.ack,\r\n                        name: command.ack.name[lang],\r\n                        default: !command.ack?.default\r\n                            ? command.ack?.type === 'checkbox'\r\n                                ? false\r\n                                : ''\r\n                            : command.ack.default[lang],\r\n                    },\r\n                };\r\n\r\n                return obj;\r\n            }),\r\n        ];\r\n    };\r\n\r\n    commands = this.getSelectedLanguageCommands();\r\n\r\n    moveRule = (dragIndex, hoverIndex) => {\r\n        const { rules } = this.state;\r\n        const sourceRule = rules.find((_, index) => index === hoverIndex);\r\n        const sortRules = rules.filter((_, index) => index !== hoverIndex);\r\n        sortRules.splice(dragIndex, 0, sourceRule);\r\n        this.setState({ rules: sortRules });\r\n    };\r\n\r\n    handleOpen = () => {\r\n        this.setState({isOpen: true,});\r\n    };\r\n\r\n    handleClose = () => {\r\n        this.setState({ isOpen: false });\r\n    };\r\n\r\n    handleSubmitOnCreate = (selectedRule, isError) => {\r\n        if (isError) {\r\n            return;\r\n        }\r\n\r\n        const id = uuid();\r\n        const shortDataRule = {\r\n            ...selectedRule,\r\n            id,\r\n            _break: true,\r\n        };\r\n\r\n        const rule = {\r\n            ...this.commands.find(command => command.rule === shortDataRule.rule),\r\n            ...shortDataRule,\r\n        };\r\n        const isUnsavedChanges = Object.values(this.state.unsavedRules).length;\r\n\r\n        this.setState(\r\n            {\r\n                rules: [...this.state.rules, rule],\r\n                unsavedRules: {\r\n                    ...this.state.unsavedRules,\r\n                    [id]: {\r\n                        id,\r\n                        wasChangedGlobally: true,\r\n                    },\r\n                },\r\n                selectedRule: !isUnsavedChanges ? rule : this.state.selectedRule,\r\n            },\r\n            () => {\r\n                if (isUnsavedChanges) {\r\n                    this.selectRule(rule.id);\r\n                }\r\n            }\r\n        );\r\n\r\n        this.handleClose();\r\n    };\r\n\r\n    handleSubmitOnEdit = (selectedRule, isError) => {\r\n        if (isError) {\r\n            return;\r\n        }\r\n\r\n        const unsavedRules = JSON.parse(JSON.stringify(this.state.unsavedRules));\r\n        unsavedRules[selectedRule.id] = { id: selectedRule.id, wasChangedGlobally: true};\r\n\r\n        this.setState({\r\n            unsavedRules,\r\n            rules: this.updateRule(selectedRule),\r\n        });\r\n        this.handleClose();\r\n    };\r\n\r\n    handleSubmitOnCopy = (selectedRule, isError) => {\r\n        if (isError) {\r\n            return;\r\n        }\r\n\r\n        const newRule = JSON.parse(JSON.stringify(selectedRule));\r\n        newRule.id = uuid();\r\n\r\n        const rules = JSON.parse(JSON.stringify(this.state.rules));\r\n        rules.push(newRule);\r\n\r\n        const unsavedRules = JSON.parse(JSON.stringify(this.state.unsavedRules));\r\n        unsavedRules[newRule.id] = {id: newRule.id, wasChangedGlobally: true};\r\n\r\n        this.setState({\r\n                rules,\r\n                unsavedRules,\r\n                selectedRule: newRule,\r\n                isOpen: false\r\n            },\r\n            () => {\r\n                this.selectRule(newRule.id);\r\n            }\r\n        );\r\n    };\r\n\r\n    selectRule = id => {\r\n        const { selectedRule, rules } = this.state;\r\n\r\n        if (selectedRule.id === id) {\r\n            // ignore\r\n            if (this.isMobile) {\r\n                this.setState({isLeftBarOpen: false});\r\n            }\r\n        } else if (this.state.unsavedRules[selectedRule.id]) {\r\n            this.setState({\r\n                pendingSelectedRuleId: id,\r\n            });\r\n        } else {\r\n            const rule = rules.find(item => item.id === id);\r\n\r\n            this.setState({\r\n                selectedRule: rule,\r\n                isLeftBarOpen: this.isMobile ? false : this.state.isLeftBarOpen\r\n            });\r\n        }\r\n    };\r\n\r\n    updateRule = selectedRule => {\r\n        const rules = JSON.parse(JSON.stringify(this.state.rules));\r\n\r\n        const item = rules.find(item => item.id === selectedRule.id);\r\n        rules[rules.indexOf(item)] = selectedRule;\r\n\r\n        return rules;\r\n    };\r\n\r\n    handleEdit = () => {\r\n        this.setState({isEdit: true});\r\n        this.handleOpen();\r\n    };\r\n\r\n    handleCopy = () => {\r\n        this.setState({isCopy: true, isEdit: true});\r\n        this.handleOpen();\r\n    };\r\n\r\n    finishEdit = editableRule => {\r\n        let selectedRule;\r\n\r\n        const { rule, id, name, _break, template } = editableRule;\r\n\r\n        // if rule was updated => apply fields\r\n        if (this.state.selectedRule.rule !== rule) {\r\n            const updatedRuleOptions = this.commands.find(command => command.rule === rule);\r\n\r\n            selectedRule = {\r\n                ...updatedRuleOptions,\r\n                name,\r\n                rule,\r\n                id,\r\n                _break,\r\n                template,\r\n            };\r\n        } else {\r\n            selectedRule = JSON.parse(JSON.stringify(editableRule));\r\n        }\r\n\r\n        const rules = JSON.parse(JSON.stringify(this.state.rules));\r\n        const _rule = rules.find(it => it.id === selectedRule.id);\r\n        if (_rule) {\r\n            rules[rules.indexOf(_rule)] = selectedRule;\r\n        } else {\r\n            rules.push(selectedRule);\r\n        }\r\n\r\n        this.setState({\r\n            isEdit: false,\r\n            isCopy: false,\r\n            rules,\r\n            selectedRule,\r\n        });\r\n    };\r\n\r\n    removeRule = id => {\r\n        const rules = this.state.rules.filter(rule => rule.id !== id);\r\n\r\n        this.setState(\r\n            {\r\n                rules,\r\n                selectedRule: rules.length ? rules[rules.length - 1] : null,\r\n            },\r\n            () => {\r\n                this.props.readConfig()\r\n                    .then(config => {\r\n                        const { rules, ...settings } = config;\r\n                        const newConfig = { rules: rules.filter(rule => rule.id !== id), ...settings };\r\n                        this.props.saveConfig(newConfig);\r\n                    });\r\n            });\r\n    };\r\n\r\n    updateConfig = async currentSelectedRule => {\r\n        const { [currentSelectedRule.id]: removedId, ...ids } = this.state.unsavedRules;\r\n        const config = await this.props.readConfig();\r\n        const { rules, ...settings } = config;\r\n\r\n        const matchingRule = rules.find(rule => rule.id === currentSelectedRule.id);\r\n        const updatedCurrentRules = this.updateRule(currentSelectedRule)\r\n\r\n        let updatedRules;\r\n        if (matchingRule) {\r\n            updatedRules = rules.map(rule =>\r\n                rule.id === currentSelectedRule.id\r\n                    ? this.getRuleShortData(currentSelectedRule)\r\n                    : rule\r\n            );\r\n        } else {\r\n            updatedRules = [...rules, this.getRuleShortData(currentSelectedRule)];\r\n        }\r\n\r\n        const newConfig = { rules: updatedRules, ...settings };\r\n        await this.props.saveConfig(newConfig);\r\n\r\n        this.setState({\r\n            selectedRule: currentSelectedRule || this.state.selectedRule || null,\r\n            rules: updatedCurrentRules,\r\n            unsavedRules: ids,\r\n        });\r\n    };\r\n\r\n    getDataFromConfig = () => {\r\n        return this.props.readConfig()\r\n            .then(config => {\r\n                const { rules, ...settings } = config;\r\n                const lang = I18n.getLanguage();\r\n\r\n                const currentRules = rules.map(rule => {\r\n                    const obj = window.commands[rule.template];\r\n\r\n                    return {\r\n                        ...obj,\r\n                        rule: obj?.name[lang],\r\n                        ack: {\r\n                            ...obj.ack,\r\n                            default: rule.ack || (obj.ack?.type === 'checkbox' ? false : ''),\r\n                            name: obj.ack?.name[lang],\r\n                        },\r\n                        args: obj.args?.map((arg, index) => ({\r\n                            ...arg,\r\n                            default: rule.args[index] || (arg?.type === 'checkbox' ? false : ''),\r\n                            name: arg?.name[lang] || '',\r\n                        })),\r\n                        name: rule.name || obj?.name[lang],\r\n                        words: rule.words,\r\n                        _break: rule._break,\r\n                        id: rule.id || uuid(),\r\n                        template: rule.template,\r\n                    };\r\n                });\r\n\r\n                this.setState({\r\n                    rules: currentRules,\r\n                    ready: true,\r\n                    selectedRule:\r\n                        currentRules.find(rule => rule.id === localStorage.getItem('selectedRule')) ||\r\n                        currentRules[currentRules.length - 1] ||\r\n                        null,\r\n                    settings,\r\n                });\r\n\r\n                return config;\r\n            });\r\n    };\r\n\r\n    revertChangesFromConfig = async selectedRule => {\r\n        const actualRules = this.state.rules;\r\n        const { [selectedRule.id]: removedId, ...ids } = this.state.unsavedRules;\r\n        const config = await this.props.readConfig();\r\n        const { rules, ...settings } = config;\r\n\r\n        const matchingRule = rules.find(rule => rule.id === selectedRule.id);\r\n        const isRuleWasUpdatedGlobally = this.state.unsavedRules[selectedRule.id]\r\n            ?.wasChangedGlobally;\r\n\r\n        let updatedRules;\r\n        if (matchingRule && isRuleWasUpdatedGlobally) {\r\n            updatedRules = actualRules.map(rule =>\r\n                rule.id === matchingRule.id\r\n                    ? {\r\n                          ...rule,\r\n                          ack: {\r\n                              ...rule.ack,\r\n                              default: matchingRule.ack || '',\r\n                          },\r\n                          args: rule.args?.map(arg => ({\r\n                              ...arg,\r\n                              default: matchingRule.arg || '',\r\n                          })),\r\n                          rule: window.commands[matchingRule.template].name[I18n.getLanguage()],\r\n                          words: matchingRule.words || '',\r\n                          name: matchingRule.name || '',\r\n                          _break: matchingRule._break || true,\r\n                      }\r\n                    : rule\r\n            );\r\n        } else if (!matchingRule) {\r\n            updatedRules = actualRules.filter(rule => rule.id !== selectedRule.id);\r\n        }\r\n\r\n        const newState = {\r\n            rules: updatedRules || actualRules,\r\n            selectedRule:\r\n                (isRuleWasUpdatedGlobally\r\n                    ? updatedRules.find(rule => rule.id === selectedRule.id)\r\n                    : this.state.selectedRule) || null,\r\n            settings,\r\n            unsavedRules: ids,\r\n        };\r\n\r\n        if (this.state.rules.length !== newState.rules.length) {\r\n            newState.selectedRule = newState.rules[newState.rules.length - 1] || null;\r\n        }\r\n\r\n        this.setState(newState);\r\n    };\r\n\r\n    saveSettings = async (localeSettings, closeModal) => {\r\n        const config = await this.props.readConfig();\r\n        const { rules } = config;\r\n\r\n        const newConfig = { rules, ...localeSettings };\r\n        await this.props.saveConfig(newConfig);\r\n        this.setState({settings: localeSettings}, () =>\r\n            closeModal());\r\n    };\r\n\r\n    setUnsavedRule = id => {\r\n        this.setState({\r\n            unsavedRules: {\r\n                ...this.state.unsavedRules,\r\n                [id]: {\r\n                    id,\r\n                    wasChangedGlobally: false,\r\n                },\r\n            },\r\n        });\r\n    };\r\n\r\n    removeUnsavedRule = id => {\r\n        const { [id]: removedId, ...ids } = this.state.unsavedRules;\r\n        this.setState({\r\n            unsavedRules: ids,\r\n        });\r\n    };\r\n\r\n    getRuleShortData = ({ _break, template, words, ack, args, name, id }) => ({\r\n        words: words || '',\r\n        ack: ack?.default || '',\r\n        args: args?.map(arg => arg.default) || [],\r\n        _break,\r\n        template,\r\n        name,\r\n        id,\r\n    });\r\n\r\n    clearStateOnConfirmModalUnmount = id => {\r\n        const { [id]: removedId, ...ids } = this.state.unsavedRules;\r\n\r\n        this.setState({\r\n            pendingSelectedRuleId: false,\r\n            unsavedRules: ids,\r\n        });\r\n    };\r\n\r\n    toggleLeftBar = () => {\r\n        window.localStorage.setItem('App.menuHidden', !this.state.isLeftBarOpen);\r\n        this.setState({isLeftBarOpen: !this.state.isLeftBarOpen,});\r\n    };\r\n\r\n    closeDrawer = () => {\r\n        this.setState({isLeftBarOpen: false});\r\n    };\r\n\r\n    renderModalDialog() {\r\n        return this.state.isOpen ?\r\n            <CreateRuleDialog\r\n                key=\"modal\"\r\n                commands={this.commands}\r\n                isEdit={this.state.isEdit}\r\n                isCopy={this.state.isCopy}\r\n                handleSubmitOnCreate={this.handleSubmitOnCreate}\r\n                handleSubmitOnEdit={this.handleSubmitOnEdit}\r\n                handleSubmitOnCopy={this.handleSubmitOnCopy}\r\n                handleClose={this.handleClose}\r\n                isOpen={this.state.isOpen}\r\n                rules={this.state.rules}\r\n                selectedRule={this.state.selectedRule}\r\n                finishEdit={this.finishEdit}\r\n            />\r\n         : null;\r\n    }\r\n\r\n    render() {\r\n        console.log(this.state);\r\n        const { classes } = this.props;\r\n        const { rules, selectedRule, isLeftBarOpen } = this.state;\r\n\r\n        if (!this.state.ready) {\r\n            return null;\r\n        }\r\n\r\n        if (this.isMobile) {\r\n            return <React.Fragment>\r\n                <Drawer\r\n                    anchor=\"left\"\r\n                    open={this.state.isLeftBarOpen}\r\n                    onClose={this.closeDrawer}>\r\n                    <DrawerComponent\r\n                        themeType={this.props.themeType}\r\n                        handleOpen={this.handleOpen}\r\n                        rules={rules}\r\n                        moveRule={this.moveRule}\r\n                        handleEdit={this.handleEdit}\r\n                        handleCopy={this.handleCopy}\r\n                        selectRule={this.selectRule}\r\n                        selectedRule={selectedRule}\r\n                        removeRule={this.removeRule}\r\n                        settings={this.state.settings}\r\n                        socket={this.props.socket}\r\n                        saveSettings={this.saveSettings}\r\n                        theme={this.props.theme}\r\n                        toggleLeftBar={this.toggleLeftBar}\r\n                        unsavedRules={this.state.unsavedRules}\r\n                        isMobile={this.isMobile}\r\n                        closeDrawer={this.closeDrawer}\r\n                    />\r\n                </Drawer>\r\n                {this.state.settings && selectedRule ?\r\n                    <RuleEditor\r\n                        key={selectedRule.id}\r\n                        selectedRule={selectedRule}\r\n                        socket={this.props.socket}\r\n                        updateConfig={this.updateConfig}\r\n                        revertChangesFromConfig={this.revertChangesFromConfig}\r\n                        pendingSelectedRuleId={this.state.pendingSelectedRuleId}\r\n                        unsavedRules={this.state.unsavedRules}\r\n                        selectRule={this.selectRule}\r\n                        clearStateOnConfirmModalUnmount={this.clearStateOnConfirmModalUnmount}\r\n                        lang={this.state.settings.language}\r\n                        setUnsavedRule={this.setUnsavedRule}\r\n                        removeUnsavedRule={this.removeUnsavedRule}\r\n                        toggleLeftBar={this.toggleLeftBar}\r\n                        isLeftBarOpen={this.state.isLeftBarOpen}\r\n                        isMobile={this.isMobile}\r\n                    />\r\n                    :\r\n                    <div className={classes.noRulesText}>{I18n.t('Create a new rule with a \"+\" on the left')}</div>}\r\n\r\n                {this.renderModalDialog()}\r\n            </React.Fragment>;\r\n        } else {\r\n            return <React.Fragment>\r\n                <SplitterLayout\r\n                    key=\"splitterLayout\"\r\n                    customClassName={clsx(\r\n                        isLeftBarOpen ? classes.hidden : classes.opened,\r\n                        classes.layout\r\n                    )}\r\n                    primaryMinSize={350}\r\n                    primaryIndex={1}\r\n                    secondaryMinSize={350}\r\n                    onSecondaryPaneSizeChange={size => (this.menuSize = parseFloat(size))}\r\n                    onDragEnd={() => window.localStorage.setItem('App.menuSize', this.menuSize.toString())}\r\n                    secondaryInitialSize={this.menuSize}>\r\n                    <DrawerComponent\r\n                        handleOpen={this.handleOpen}\r\n                        rules={rules}\r\n                        moveRule={this.moveRule}\r\n                        handleEdit={this.handleEdit}\r\n                        handleCopy={this.handleCopy}\r\n                        selectRule={this.selectRule}\r\n                        selectedRule={selectedRule}\r\n                        removeRule={this.removeRule}\r\n                        instance={this.props.instance}\r\n                        settings={this.state.settings}\r\n                        socket={this.props.socket}\r\n                        saveSettings={this.saveSettings}\r\n                        theme={this.props.theme}\r\n                        unsavedRules={this.state.unsavedRules}\r\n                        isMobile={this.isMobile}\r\n                    />\r\n                    {this.state.settings && selectedRule ?\r\n                        <RuleEditor\r\n                            selectedRule={selectedRule}\r\n                            socket={this.props.socket}\r\n                            updateRule={this.updateRule}\r\n                            updateConfig={this.updateConfig}\r\n                            revertChangesFromConfig={this.revertChangesFromConfig}\r\n                            pendingSelectedRuleId={this.state.pendingSelectedRuleId}\r\n                            unsavedRules={this.state.unsavedRules}\r\n                            selectRule={this.selectRule}\r\n                            clearStateOnConfirmModalUnmount={this.clearStateOnConfirmModalUnmount}\r\n                            lang={this.state.settings.language}\r\n                            setUnsavedRule={this.setUnsavedRule}\r\n                            removeUnsavedRule={this.removeUnsavedRule}\r\n                            toggleLeftBar={this.toggleLeftBar}\r\n                            isLeftBarOpen={this.state.isLeftBarOpen}\r\n                            isMobile={this.isMobile}\r\n                        />\r\n                        :\r\n                        <div className={classes.noRulesText}>{I18n.t('Create a new rule with a \"+\" on the left')}</div>}\r\n                </SplitterLayout>\r\n                {this.renderModalDialog()}\r\n            </React.Fragment>;\r\n        }\r\n    }\r\n}\r\n\r\nLayout.propTypes = {\r\n    socket: PropTypes.object.isRequired,\r\n    theme: PropTypes.object.isRequired,\r\n    themeType: PropTypes.string,\r\n    instance: PropTypes.number.isRequired,\r\n    readConfig: PropTypes.func.isRequired,\r\n    saveConfig: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default withStyles(styles)(withWidth()(Layout));\r\n","import React from 'react';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport { MuiThemeProvider } from '@material-ui/core/styles';\r\n\r\nimport Loader from '@iobroker/adapter-react/Components/Loader';\r\nimport I18n from '@iobroker/adapter-react/i18n';\r\nimport GenericApp from '@iobroker/adapter-react/GenericApp';\r\nimport Layout from './components/Layout';\r\nimport isEqual from 'lodash.isequal';\r\n\r\n// Icons\r\n\r\nconst styles = theme => ({\r\n    root: {},\r\n    logo: {\r\n        width: 32,\r\n        height: 32,\r\n        padding: theme.spacing(1),\r\n        display: 'inline-block',\r\n    },\r\n});\r\n\r\nclass App extends GenericApp {\r\n    constructor(props) {\r\n        const extendedProps = {...props};\r\n        extendedProps.translations = {\r\n            'en': require('./i18n/en'),\r\n            'de': require('./i18n/de'),\r\n            'ru': require('./i18n/ru'),\r\n            'pt': require('./i18n/pt'),\r\n            'nl': require('./i18n/nl'),\r\n            'fr': require('./i18n/fr'),\r\n            'it': require('./i18n/it'),\r\n            'es': require('./i18n/es'),\r\n            'pl': require('./i18n/pl'),\r\n            'zh-cn': require('./i18n/zh-cn'),\r\n        };\r\n\r\n        super(props, extendedProps);\r\n    }\r\n\r\n    onConnectionReady() {\r\n        const newState = {};\r\n\r\n        this.socket\r\n            .getSystemConfig()\r\n            .then(systemConfig => {\r\n                newState.systemConfig = systemConfig;\r\n                return this.readConfig();\r\n            })\r\n            .then(config => {\r\n                console.log(config);\r\n                this.setState({ config, ready: true });\r\n                if (config.language !== I18n.getLanguage() && config.language) {\r\n                    I18n.setLanguage(config.language);\r\n                }\r\n            })\r\n            .catch(e => this.showError(e));\r\n    }\r\n\r\n    readConfig() {\r\n        return this.socket\r\n            .getObject('system.adapter.' + this.adapterName + '.' + this.instance)\r\n            .then(config => {\r\n                const native = config.native || {};\r\n                native.rules = native.rules || [];\r\n                native.sayitInstance = native.sayitInstance || '';\r\n                native.language = native.language || '';\r\n                native.processorId = native.processorId || '';\r\n                native.processorTimeout = native.processorTimeout || 1000;\r\n                return native;\r\n            });\r\n    }\r\n\r\n    saveConfig(config) {\r\n        return this.socket\r\n            .getObject('system.adapter.' + this.adapterName + '.' + this.instance)\r\n            .then(obj => {\r\n                if (!isEqual(obj.native, config)) {\r\n                    obj.native = config;\r\n                    return this.socket.setObject(\r\n                        'system.adapter.' + this.adapterName + '.' + this.instance,\r\n                        obj\r\n                    );\r\n                }\r\n            });\r\n    }\r\n\r\n    render() {\r\n        if (!this.state.config || !this.state.ready) {\r\n            return <MuiThemeProvider theme={this.state.theme}>\r\n                    <Loader theme={this.state.themeType} />\r\n                </MuiThemeProvider>;\r\n        }\r\n\r\n        return <MuiThemeProvider theme={this.state.theme}>\r\n            <div className=\"App\">\r\n                <Layout\r\n                    themeType={this.state.themeType}\r\n                    theme={this.state.theme}\r\n                    socket={this.socket}\r\n                    instance={this.instance}\r\n                    readConfig={this.readConfig.bind(this)}\r\n                    saveConfig={this.saveConfig.bind(this)}\r\n                />\r\n                {this.renderError()}\r\n            </div>\r\n        </MuiThemeProvider>;\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(App);\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport * as Sentry from '@sentry/browser';\r\nimport * as SentryIntegrations from '@sentry/integrations';\r\nimport { MuiThemeProvider } from '@material-ui/core/styles';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nimport './index.css';\r\nimport App from './App';\r\nimport { version } from '../package.json';\r\nimport theme from '@iobroker/adapter-react/Theme';\r\nimport Utils from '@iobroker/adapter-react/Components/Utils';\r\n\r\nwindow.adapterName = 'text2command';\r\nlet themeName = Utils.getThemeName();\r\n\r\nconsole.log('iobroker.' + window.adapterName + '@' + version + ' using theme \"' + themeName + '\"');\r\n\r\nfunction build() {\r\n    return ReactDOM.render(\r\n        <MuiThemeProvider theme={theme(themeName)}>\r\n            <App\r\n                onThemeChange={_theme => {\r\n                    themeName = _theme;\r\n                    build();\r\n                }}\r\n            />\r\n        </MuiThemeProvider>,\r\n        document.getElementById('root')\r\n    );\r\n}\r\n\r\n\r\n// if not local development\r\nif (window.location.host !== 'localhost:3000') {\r\n    Sentry.init({\r\n        dsn: 'https://9806f910556240219f831ecfe2ee3ad1@sentry.iobroker.net/87',\r\n        release: 'iobroker.' + window.adapterName + '@' + version,\r\n        integrations: [new SentryIntegrations.Dedupe()],\r\n    });\r\n}\r\n\r\nbuild();\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: http://bit.ly/CRA-PWA\r\nserviceWorker.register();\r\n"],"sourceRoot":""}